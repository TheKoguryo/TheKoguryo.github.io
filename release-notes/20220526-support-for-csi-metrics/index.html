<!DOCTYPE html>
<html lang="ko">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Support for CSI metrics - TheKoguryo&#39;s 기술 블로그</title>
<meta name="generator" content="Hugo 0.139.3">
<link href="https://thekoguryo.github.io/index.xml" rel="alternate" type="application/rss+xml">
<link rel="canonical" href="https://thekoguryo.github.io/release-notes/20220526-support-for-csi-metrics/">
<link rel="stylesheet" href="https://thekoguryo.github.io/css/theme.min.css">
<link rel="stylesheet" href="https://thekoguryo.github.io/css/d2coding.css">
<link rel="stylesheet" href="https://thekoguryo.github.io/css/fontawesome-all.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nanum Gothic" >
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Gowun Dodum" >
<script src="https://use.fontawesome.com/releases/v5.15.4/js/all.js"></script>
<link rel="stylesheet" href="https://thekoguryo.github.io/css/chroma.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://thekoguryo.github.io/js/functions.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js"></script>
<script src="https://thekoguryo.github.io/js/jquery.backtothetop/jquery.backtothetop.min.js"></script>
<script src="https://thekoguryo.github.io/js/jqcloud/jqcloud.js"></script>
<link rel="stylesheet" href="https://thekoguryo.github.io/js/jqcloud/jqcloud.css">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-106207316-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-106207316-1');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2708881668962858"
     crossorigin="anonymous"></script><meta property="og:url" content="https://thekoguryo.github.io/release-notes/20220526-support-for-csi-metrics/">
  <meta property="og:site_name" content="TheKoguryo&#39;s 기술 블로그">
  <meta property="og:title" content="Support for CSI metrics">
  <meta property="og:description" content="Persistent Volume에 대한 용량에 대한 모니터링 지원을 추가적인 메트릭을 지원합니다.">
  <meta property="og:locale" content="ko">
  <meta property="og:type" content="article">
    <meta property="article:section" content="release-notes">
    <meta property="article:published_time" content="2022-05-26T00:00:01+00:00">
    <meta property="article:modified_time" content="2022-05-26T00:00:01+00:00">
    <meta property="article:tag" content="Metric">
    <meta property="article:tag" content="Csi">

</head>
<body>
<div class="container"><header>
<h1>TheKoguryo&#39;s 기술 블로그</h1>

 <span class="version">&nbsp;Version 2025-08-29</span>
<a href="https://github.com/TheKoguryo" class="github"><i class="fab fa-github"></i></a>
</header>
<div class="menu">
<nav>
<ul>
<li ><a href="/">Home</a></li>
<li ><a href="/oci">OCI</a></li>
<li ><a href="/oracle-cloudnative">OKE/Cloud Native</a></li>
<li ><a href="/blog">Blog</a></li>
<li ><a href="/release-notes">OCI Release Notes</a></li>
<li ><a href="/tags">Tag Cloud</a></li>
<li ><a href="https://github.com/TheKoguryo/TheKoguryo.github.io/issues/new">Feedback</a></li>
<li ><a href="/link">Link</a></li>

</ul>
</nav>
</div>
<div class="content-container">
<main><h1 id="support-for-csi-metrics">Support for CSI metrics</h1>
<p>Persistent Volume에 대한 용량에 대한 모니터링 지원을 위해 Block Volume을 CSI 드라이버로 Persistent Volume Claims (PVCs)을 생성하는 경우 CSI 용량 통계를 위한 메트릭을 지원하게 되었습니다. 신규 클러스터는 물론, 기존 생성된 클러스터도 1.19 버전 이상에서 이미 기능활성화 되어 바로 사용할 수 있습니다.</p>
<ul>
<li><a href="https://docs.oracle.com/en-us/iaas/releasenotes/changes/eb03b851-8239-4ab8-93be-e31bd094aee5/">Release Notes - Support for CSI metrics</a></li>
</ul>
<h2 id="업데이트-사항">업데이트 사항</h2>
<h3 id="csi-metris-지원">CSI metris 지원</h3>
<p>Block Volume을 CSI 드라이버로 Persistent Volume Claims (PVCs)을 생성하는 경우 CSI 용량 통계를 위한 메트릭을 지원합니다. 클러스터 생성시 기본 배포된 storageClassName: &ldquo;oci-bv&quot;을 사용하는 경우에 해당합니다.</p>
<ul>
<li>지원 메트릭
<ul>
<li><code>kubelet_volume_stats_available_bytes</code></li>
<li><code>kubelet_volume_stats_capacity_bytes</code></li>
<li><code>kubelet_volume_stats_inodes</code></li>
<li><code>kubelet_volume_stats_inodes_free</code></li>
<li><code>kubelet_volume_stats_inodes_used</code></li>
<li><code>kubelet_volume_stats_used_bytes</code></li>
</ul>
</li>
</ul>
<ol>
<li>
<p>Block Volme CSI 드라이버를 통해 Persistent Volume Claims (PVCs)을 생성합니다.</p>
<ul>
<li><a href="../../oracle-cloudnative/oke/6.persistent-volume/1.block-volume/">1.6.1 Block Volume 사용하기</a></li>
</ul>
</li>
<li>
<p>메트릭을 확인하기 위해 Prometheus를 설치합니다.</p>
<ul>
<li><a href="../../oracle-cloudnative/oss/monitoring/1.install-prometheus-grafana/">4.3.1 Prometheus&amp;Grafana 설치하기</a></li>
</ul>
</li>
<li>
<p>Prometheus UI에 접속합니다.</p>
<ul>
<li>편의상 prometheus-kube-prometheus-prometheus의 서비스 타입을 LoadBalancer로 설정하였습니다.</li>
</ul>
</li>
<li>
<p>해당 메트릭이 보이는 지 조회하면 아래와 같이 메트릭이 보입니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20220603212457396.png" alt='image-20220603212457396' onerror="this.onerror=null;this.src='images\/image-20220603212457396.png';" />
</p>
</li>
<li>
<p>PVC 생성 시간 확인</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ kubectl get pvc csi-bvs-pvc -o yaml
</span></span><span class="line"><span class="cl">apiVersion: v1
</span></span><span class="line"><span class="cl">kind: PersistentVolumeClaim
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  annotations:
</span></span><span class="line"><span class="cl">    kubectl.kubernetes.io/last-applied-configuration: <span class="p">|</span>
</span></span><span class="line"><span class="cl">      <span class="o">{</span><span class="s2">&#34;apiVersion&#34;</span>:<span class="s2">&#34;v1&#34;</span>,<span class="s2">&#34;kind&#34;</span>:<span class="s2">&#34;PersistentVolumeClaim&#34;</span>,<span class="s2">&#34;metadata&#34;</span>:<span class="o">{</span><span class="s2">&#34;annotations&#34;</span>:<span class="o">{}</span>,<span class="s2">&#34;name&#34;</span>:<span class="s2">&#34;csi-bvs-pvc&#34;</span>,<span class="s2">&#34;namespace&#34;</span>:<span class="s2">&#34;monitoring&#34;</span><span class="o">}</span>,<span class="s2">&#34;spec&#34;</span>:<span class="o">{</span><span class="s2">&#34;accessModes&#34;</span>:<span class="o">[</span><span class="s2">&#34;ReadWriteOnce&#34;</span><span class="o">]</span>,<span class="s2">&#34;resources&#34;</span>:<span class="o">{</span><span class="s2">&#34;requests&#34;</span>:<span class="o">{</span><span class="s2">&#34;storage&#34;</span>:<span class="s2">&#34;50Gi&#34;</span><span class="o">}}</span>,<span class="s2">&#34;storageClassName&#34;</span>:<span class="s2">&#34;oci-bv&#34;</span><span class="o">}}</span>
</span></span><span class="line"><span class="cl">    pv.kubernetes.io/bind-completed: <span class="s2">&#34;yes&#34;</span>
</span></span><span class="line"><span class="cl">    pv.kubernetes.io/bound-by-controller: <span class="s2">&#34;yes&#34;</span>
</span></span><span class="line"><span class="cl">    volume.beta.kubernetes.io/storage-provisioner: blockvolume.csi.oraclecloud.com
</span></span><span class="line"><span class="cl">    volume.kubernetes.io/selected-node: 10.0.10.234
</span></span><span class="line"><span class="cl">  creationTimestamp: <span class="s2">&#34;2022-06-03T09:34:49Z&#34;</span>
</span></span><span class="line"><span class="cl">  ...
</span></span></code></pre></div></li>
<li>
<p>첫 메트릭 수집시간</p>
<p>







<img class="img-fluid1" src="../images/image-20220603213404841.png" alt='image-20220603213404841' onerror="this.onerror=null;this.src='images\/image-20220603213404841.png';" />
</p>
</li>
<li>
<p>PVC 생성시간: 09:34:49와 첫 메트릭 값 수집시간:09:37:49로 Bitnami Prometheus Helm Chart의 scrape_interval이 기본 15초 또는 Prometheus 기본에 1분 이라고 하는 데 조금 더 지나야 되네요. 정확한 설정은 다음에 확인하는 걸로&hellip;.</p>
</li>
</ol>
<br>
<br>
<div class="panel panel-caution">
    <div class="panel-body" style="text-align: center;">
    <p>이 글은 개인으로서, 개인의 시간을 할애하여 작성된 글입니다. 글의 내용에 오류가 있을 수 있으며, 글 속의 의견은 개인적인 의견입니다.</p>
    </div>
    </div>

 <footer><p class="powered">Powered by <a href="https://gohugo.io">Hugo</a>. Theme by <a href="https://github.com/thingsym/hugo-theme-techdoc">TechDoc</a>. Design by <a href="https://www.thingslabo.com/">Thingsym</a>.</p>
</footer>
</main><div class="sidebar">


<nav>
<ul>


<li>
  <form method="get" action="https://thekoguryo.github.io//search">
    <input type="text" id="search-box" name="q" placeholder="Search"/>
  </form>
  
  <script type="text/javascript">
    $(document).ready(function() {
      $('#search-box').val($('#search-query').val());
    });
  </script>
</li>
<li><a> </a></li>

    
    

      
        

    
    

    
    

    
    

    
    

    
    
</ul>
</nav>


<div class="sidebar-footer"></div>
</div>
</div><a href="#" id="backtothetop-fixed" class="backtothetop" 
 data-backtothetop-duration="600"
 data-backtothetop-easing="easeOutQuart"
 data-backtothetop-fixed-fadeIn="1000"
 data-backtothetop-fixed-fadeOut="1000"
 data-backtothetop-fixed-bottom="10"
 data-backtothetop-fixed-right="20">
<span class="fa-layers fa-fw">
<i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up" style="color: #74A683;"></i>
</span></a>

<script src="https://thekoguryo.github.io/js/copy-code-button.js"></script></div>
</body>
</html>
