<!DOCTYPE html>
<html lang="ko">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>1.8 애플리케이션 로그 모니터링 - TheKoguryo&#39;s 기술 블로그</title>
<meta name="generator" content="Hugo 0.89.2" />
<link href="https://thekoguryo.github.io/oci-cloudnativeindex.xml" rel="alternate" type="application/rss+xml">
<link rel="canonical" href="https://thekoguryo.github.io/oci-cloudnative/oke/basic/8.monitor-application-log/">
<link rel="stylesheet" href="https://thekoguryo.github.io/oci-cloudnative/css/theme.min.css">
<link rel="stylesheet" href="https://thekoguryo.github.io/oci-cloudnative/css/d2coding.css">
<link rel="stylesheet" href="https://thekoguryo.github.io/oci-cloudnative/css/fontawesome-all.min.css">
<script src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
<link rel="stylesheet" href="https://thekoguryo.github.io/oci-cloudnative/css/chroma.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://thekoguryo.github.io/oci-cloudnative/js/functions.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js"></script>
<script src="https://thekoguryo.github.io/oci-cloudnative/js/jquery.backtothetop/jquery.backtothetop.min.js"></script>
<script src="https://thekoguryo.github.io/oci-cloudnative/js/jqcloud/jqcloud.js"></script>
<link rel="stylesheet" href="https://thekoguryo.github.io/oci-cloudnative/js/jqcloud/jqcloud.css">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-106207316-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-106207316-1');
</script>
</head>
<body>
<div class="container"><header>
<h1>TheKoguryo&#39;s 기술 블로그</h1>

 <span class="version">Version 2021.11.13</span>
<a href="https://github.com/TheKoguryo" class="github"><i class="fab fa-github"></i></a>
</header>
<div class="menu">
<nav>
<ul>
<li ><a href="https://thekoguryo.github.io">Home</a></li>
<li ><a href="/oci-cloudnative/">OCI Cloud Native</a></li>
<li ><a href="https://github.com/TheKoguryo/TheKoguryo.github.io/issues/new">Feedback</a></li></ul>
</nav>
</div>
<div class="content-container">
<main><h1 id="18-애플리케이션-로그-모니터링">1.8 애플리케이션 로그 모니터링</h1>
<p>OKE 상에 배포되어 있는 애플리케이션 로그 모니터링을 OCI Logging 서비스를 통해 모니터링할 수 있습니다.</p>
<h2 id="oci-logging-서비스-사용-권한-설정">OCI Logging 서비스 사용 권한 설정</h2>
<h3 id="worker-node에-대한-dynamic-group-만들기">Worker Node에 대한 Dynamic Group 만들기</h3>
<ol>
<li>
<p>OCI 콘솔에 로그인합니다.</p>
</li>
<li>
<p>좌측 상단 햄버거 메뉴에서 <strong>Identity &amp; Security</strong> &gt; **Identity ** &gt; <strong>Compartments</strong>로 이동합니다.</p>
</li>
<li>
<p>OKE 클러스터가 있는 Compartment의 OCID를 확인합니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211114231550225.png" alt='image-20211114231550225' />
</p>
</li>
<li>
<p>좌측 <strong>Dynamic Group</strong> 메뉴로 이동하여 아래 규칙을 가진 Dynamic Group을 만듭니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">instance.compartment.id <span class="o">=</span> <span class="s1">&#39;&lt;compartment-ocid&gt;&#39;</span>
</code></pre></div><p>







<img class="img-fluid1" src="../images/image-20211114232705111.png" alt='image-20211114232705111' />
</p>
</li>
</ol>
<h3 id="dynamic-group에-대한-oci-logging-서비스-권한-부여하기">Dynamic Group에 대한 OCI Logging 서비스 권한 부여하기</h3>
<ol>
<li>
<p>좌측 <strong>Policy</strong> 메뉴로 이동하여 아래 규칙을 가진 Policy을 만듭니다. 방금 생성한 Dynamic Group에 대한 Policy를 만듭니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">allow dynamic-group &lt;dynamic-group-name&gt; to use log-content in compartment &lt;compartment-name&gt;
</code></pre></div><p>







<img class="img-fluid1" src="../images/image-20211114234230697.png" alt='image-20211114234230697' />
</p>
</li>
</ol>
<h2 id="컨테이너를-위한-custom-log-설정하기">컨테이너를 위한 Custom Log 설정하기</h2>
<h3 id="log-group-만들기">Log Group 만들기</h3>
<p>Log Group은 로그들을 관리하는 말 그대로 로그의 묶음 단위 입니다. 커스텀 로그를 만들기 위해 먼저 만듭니다.</p>
<ol>
<li>
<p>좌측 상단 햄버거 메뉴에서 <strong>Observability</strong> <strong>&amp;</strong> <strong>Management</strong> &gt; <strong>Logging</strong> &gt; <strong>Log Groups</strong>로 이동합니다.</p>
</li>
<li>
<p>Create Log Group을 클릭하여 로그 그룹을 만듭니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211116162814371.png" alt='image-20211116162814371' />
</p>
</li>
</ol>
<h3 id="custom-log-만들기">Custom Log 만들기</h3>
<p>Custom Log는 커스텀 애플리케이션에서 수집하는 로그에 매핑되는 것입니다. Custom Log를 정의하고, 이에 대한 로그 수집기를 정의합니다.</p>
<ol>
<li>
<p>Resources &gt; Logs 메뉴로 이동하여 <strong>Create custom log</strong>를 클릭합니다.</p>
</li>
<li>
<p>로그 이름과 보관 주기 등을 설정하여 custom log를 만듭니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211116164721170.png" alt='image-20211116164721170' />
</p>
</li>
<li>
<p>이해를 돕고자 Agent는 별도로 설정합니다. 여기서는 일단 <strong>Add configuration later</strong> 선택</p>
<p>







<img class="img-fluid1" src="../images/image-20211116165037266.png" alt='image-20211116165037266' />
</p>
</li>
</ol>
<h3 id="agent-configuration-설정">Agent Configuration 설정</h3>
<p>Agent Configuration는 로그를 수집하는 agent를 설정하는 부분입니다.</p>
<ol>
<li>
<p><strong>Logging</strong> &gt; <strong>Agent Configurations</strong> 메뉴로 이동하여 <strong>Create agent log</strong>를 클릭합니다.</p>
</li>
<li>
<p>Agent 이름 및 대상 Host Group을 앞서 만든 Dynamic Group으로 지정합니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211116165541687.png" alt='image-20211116165541687' />
</p>
</li>
<li>
<p>Agent 설정 부분에서 로그가 위치한 경로 및 수집된 로그의 전달 위치를 지정합니다.</p>
<ul>
<li>
<p>log input: <strong>/var/log/containers/*.log</strong></p>
<p>앞서 지정한 Dynamic Group상에 있는 VM, 여기서는 OKE 클러스터 Worker Node VM 상에 수집할 로그의 위치를 지정합니다.<strong>입력하고 엔터키를 꼭 칩니다.</strong></p>
</li>
<li>
<p>log destination: 수집한 로그를 전달한 앞서 생성한 custom log 이름을 지정합니다.</p>
</li>
</ul>
<p>







<img class="img-fluid1" src="../images/image-20211116165807986.png" alt='image-20211116165807986' />
</p>
</li>
</ol>
<h3 id="참고-worker-node-vm상에-컨테이너-로그-위치">참고: Worker Node VM상에 컨테이너 로그 위치</h3>
<ol>
<li>
<p>Worker Node VM에 SSH로 접속이 가능한 환경, 예, bastion host에서 Worker Node에 접속해 보면 컨테이너 로그 위치는 다음과 같습니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[</span>opc@bastion-host ~<span class="o">]</span>$ ssh opc@10.0.10.175
Last login: Tue Nov <span class="m">16</span> 06:43:43 <span class="m">2021</span> from bastion-host.suba22926d1b.okecluster1.oraclevcn.com
<span class="o">[</span>opc@oke-cjy33uzxhyq-nkglpmyewja-siouvw2ymqq-2 ~<span class="o">]</span>$ sudo su
<span class="o">[</span>root@oke-cjy33uzxhyq-nkglpmyewja-siouvw2ymqq-2 opc<span class="o">]</span><span class="c1"># cd /var/log/containers/</span>
<span class="o">[</span>root@oke-cjy33uzxhyq-nkglpmyewja-siouvw2ymqq-2 containers<span class="o">]</span><span class="c1"># ls -la</span>
total <span class="m">16</span>
drwxr-xr-x.  <span class="m">2</span> root root <span class="m">4096</span> Nov <span class="m">15</span> 14:05 .
drwxr-xr-x. <span class="m">13</span> root root <span class="m">4096</span> Nov <span class="m">15</span> 13:55 ..
lrwxrwxrwx.  <span class="m">1</span> root root  <span class="m">100</span> Nov <span class="m">15</span> 13:52 coredns-c5d4bf466-qdgrh_kube-system_coredns-a533d7375a4bd90b894d533e637bae6ce38e2e7d89cd0ff16e34bd120111c7e4.log -&gt; /var/log/pods/kube-system_coredns-c5d4bf466-qdgrh_24b226a0-0fb3-4ede-b02f-17b177e6c248/coredns/0.log
...
lrwxrwxrwx.  <span class="m">1</span> root root  <span class="m">101</span> Nov <span class="m">15</span> 14:05 nginx-bvs-pvc-7b574c9c5c-vdpdh_default_nginx-cc996c8fd2281d1bec7fdad75518c66a2ec6f03adc214f8bbd97c26967e8d0e7.log -&gt; /var/log/pods/default_nginx-bvs-pvc-7b574c9c5c-vdpdh_aab712c6-81e1-434c-b051-f3e8fe50fa24/nginx/0.log
lrwxrwxrwx.  <span class="m">1</span> root root  <span class="m">106</span> Nov <span class="m">15</span> 13:52 proxymux-client-cb86k_kube-system_proxymux-client-471c1c80fe2dc01c5e1413819af58d968796541cc744384f1b2daa566873d8ba.log -&gt; /var/log/pods/kube-system_proxymux-client-cb86k_153b7b7a-a777-4be9-b971-657eb8ecdddd/proxymux-client/0.log
</code></pre></div></li>
<li>
<p><code>/var/log/containers/*.log</code>는 위에서 보는 것처럼 링크라서 kubernetes namespace 기준으로 하고 싶다면, 로그 경로를  default namespace인 경우<code>/var/log/pods/default_*/*/*.log</code> 이렇게 해도 되겠습니다.</p>
</li>
</ol>
<h2 id="로깅-테스트">로깅 테스트</h2>
<ol>
<li>
<p>애플리케이션 로그 확인을 위해 이전 가이드에 샘플로 배포된 nginx 앱을 접속해 봅니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211116171348098.png" alt='image-20211116171348098' />
</p>
</li>
<li>
<p>발생한 POD 로그는 다음과 같습니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">oke_admin@cloudshell:~ <span class="o">(</span>ap-seoul-1<span class="o">)</span>$ kubectl logs nginx-bvs-pvc-7b574c9c5c-vdpdh -f
...
10.244.0.128 - - <span class="o">[</span>16/Nov/2021:08:10:46 +0000<span class="o">]</span> <span class="s2">&#34;GET /?customlogtest HTTP/1.1&#34;</span> <span class="m">304</span> <span class="m">0</span> <span class="s2">&#34;-&#34;</span> <span class="s2">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36&#34;</span> <span class="s2">&#34;10.179.87.76&#34;</span>
</code></pre></div></li>
<li>
<p>동일한 로그가 Worker Node VM 상에서도 로그를 조회해 보면 <code>/var/log/containers/*.log</code> 위치에 발생하는 것을 확인 할 수 있습니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[</span>root@oke-cjy33uzxhyq-nkglpmyewja-siouvw2ymqq-2 containers<span class="o">]</span><span class="c1"># pwd</span>
/var/log/containers
<span class="o">[</span>root@oke-cjy33uzxhyq-nkglpmyewja-siouvw2ymqq-2 containers<span class="o">]</span><span class="c1"># tail -f nginx-bvs-pvc-7b574c9c5c-vdpdh_default_nginx-cc996c8fd2281d1bec7fdad75518c66a2ec6f03adc214f8bbd97c26967e8d0e7.log</span>
...
2021-11-16T08:10:46.961696444+00:00 stdout F 10.244.0.128 - - <span class="o">[</span>16/Nov/2021:08:10:46 +0000<span class="o">]</span> <span class="s2">&#34;GET /?customlogtest HTTP/1.1&#34;</span> <span class="m">304</span> <span class="m">0</span> <span class="s2">&#34;-&#34;</span> <span class="s2">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36&#34;</span> <span class="s2">&#34;10.179.87.76&#34;</span>
</code></pre></div></li>
<li>
<p>OCI 서비스 콘솔에서 Logging 화면으로 다시 돌아갑니다.</p>
</li>
<li>
<p>Agent, Logs, Log Groups 각 화면에서 <strong>Resources</strong> &gt; <strong>Explore Log</strong>에서 로그를 조회 할 수 있습니다. 검색을 위해서는 로그목록 오른쪽위에 있는 <strong>Explore with Log Search</strong>를 클릭합니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211116173233050.png" alt='image-20211116173233050' />
</p>
</li>
<li>
<p>Custom filters 항목에서 POD 이름 또는 앞서 테스트 URL에 있는 customlogtest 같이 검색값으로 조회하면 됩니다. <strong>Custom filters에 값을 입력하고 엔터키를 꼭 칩니다.</strong></p>
<p>







<img class="img-fluid1" src="../images/image-20211116174512275.png" alt='image-20211116174512275' />
</p>
</li>
<li>
<p>검색된 로그 데이터를 확인할 수 있습니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211116174616664.png" alt='image-20211116174616664' />
</p>
</li>
</ol>
<br>
<br>
<em>** 이 글은 개인으로서, 개인의 시간을 할애하여 작성된 글입니다. 글의 내용에 오류가 있을 수 있으며, 글 속의 의견은 개인적인 의견입니다. **</em>

 <div class="edit-meta">Last updated on 14 Nov 2021<br></div><nav class="pagination"><a class="nav nav-prev" href="https://thekoguryo.github.io/oci-cloudnative/oke/basic/7.supported-version-and-upgrade/" title="1.7 Kubernetes 버전 업그레이드"><i class="fas fa-arrow-left" aria-hidden="true"></i> Prev - 1.7 Kubernetes 버전 업그레이드</a>
<a class="nav nav-next" href="https://thekoguryo.github.io/oci-cloudnative/oke/basic/1.oke/" title="1.1 OKE(Oracle Container Engine for Kubernetes) 소개">Next - 1.1 OKE(Oracle Container Engine for Kubernetes) 소개 <i class="fas fa-arrow-right" aria-hidden="true"></i></a>
</nav><footer><p class="powered">Powered by <a href="https://gohugo.io">Hugo</a>. Theme by <a href="https://github.com/thingsym/hugo-theme-techdoc">TechDoc</a>. Design by <a href="https://www.thingslabo.com/">Thingsym</a>.</p>
</footer>
</main><div class="sidebar">
<nav>
<ul>


<li>
  <form method="get" action="https://thekoguryo.github.io/oci-cloudnative/search">
    <input type="text" id="search-box" name="q" placeholder="Search"/>
  </form>
  
  <script type="text/javascript">
    $(document).ready(function() {
      $('#search-box').val($('#search-query').val());
    });
  </script>
</li>
<li><a> </a></li>



<li class="parent has-sub-menu">
  <a href="https://thekoguryo.github.io/oci-cloudnative/oke/">
    OKE(Oracle Container Engine for Kubernetes)
    <button type="button" class="toggleButton">
      <span class="right  hidden">
        <svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right">
          <polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"></polyline>
        </svg></span>
      <span class="down " >
        <svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down">
          <polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"></polyline>
        </svg>
      </span>
    </button>
  </a>
<ul class="sub-menu">



<li class="parent has-sub-menu">
  <a href="https://thekoguryo.github.io/oci-cloudnative/oke/basic/">
    1. OKE 기초
    <button type="button" class="toggleButton">
      <span class="right  hidden">
        <svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right">
          <polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"></polyline>
        </svg></span>
      <span class="down " >
        <svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down">
          <polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"></polyline>
        </svg>
      </span>
    </button>
  </a>
<ul class="sub-menu">
<li class=""><a href="https://thekoguryo.github.io/oci-cloudnative/oke/basic/1.oke/">1.1 OKE(Oracle Container Engine for Kubernetes) 소개</a></li>
<li class=""><a href="https://thekoguryo.github.io/oci-cloudnative/oke/basic/2.install-quick-oke-cluster/">1.2 OKE 클러스터 만들기</a></li>



<li class=" has-sub-menu">
  <a href="https://thekoguryo.github.io/oci-cloudnative/oke/basic/3.access-cluster/">
    1.3 OKE 클러스터 연결하기
    <button type="button" class="toggleButton">
      <span class="right ">
        <svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right">
          <polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"></polyline>
        </svg></span>
      <span class="down  hidden" >
        <svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down">
          <polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"></polyline>
        </svg>
      </span>
    </button>
  </a>
<ul class=" hidden">
<li class=""><a href="https://thekoguryo.github.io/oci-cloudnative/oke/basic/3.access-cluster/1.cloudshell-access/">1.3.1 Cloud Shell로 클러스터 연결하기</a></li>
<li class=""><a href="https://thekoguryo.github.io/oci-cloudnative/oke/basic/3.access-cluster/2.local-access/">1.3.2 로컬 환경에서 클러스터 연결하기</a></li>
</ul>
  
</li>
<li class=""><a href="https://thekoguryo.github.io/oci-cloudnative/oke/basic/4.deploy-docker-hub-image-with-lb/">1.4 앱 배포 및 Load Balancer 사용하기</a></li>
<li class=""><a href="https://thekoguryo.github.io/oci-cloudnative/oke/basic/5.deploy-ocir-image/">1.5 OCIR 이미지 사용하기</a></li>



<li class=" has-sub-menu">
  <a href="https://thekoguryo.github.io/oci-cloudnative/oke/basic/6.persistent-volume/">
    1.6 Persistent Volume 사용하기
    <button type="button" class="toggleButton">
      <span class="right ">
        <svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right">
          <polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"></polyline>
        </svg></span>
      <span class="down  hidden" >
        <svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down">
          <polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"></polyline>
        </svg>
      </span>
    </button>
  </a>
<ul class=" hidden">
<li class=""><a href="https://thekoguryo.github.io/oci-cloudnative/oke/basic/6.persistent-volume/1.block-volume/">1.6.1 Block Volume 사용하기</a></li>
<li class=""><a href="https://thekoguryo.github.io/oci-cloudnative/oke/basic/6.persistent-volume/2.file-storage/">1.6.2 File Storage 사용하기</a></li>
</ul>
  
</li>
<li class=""><a href="https://thekoguryo.github.io/oci-cloudnative/oke/basic/7.supported-version-and-upgrade/">1.7 Kubernetes 버전 업그레이드</a></li>
<li class="active"><a href="https://thekoguryo.github.io/oci-cloudnative/oke/basic/8.monitor-application-log/">1.8 애플리케이션 로그 모니터링</a></li>
</ul>
  
</li>
</ul>
  
</li>
</ul>
</nav>


<div class="sidebar-footer"></div>
</div>
</div><a href="#" id="backtothetop-fixed" class="backtothetop"
 data-backtothetop-duration="600"
 data-backtothetop-easing="easeOutQuart"
 data-backtothetop-fixed-fadeIn="1000"
 data-backtothetop-fixed-fadeOut="1000"
 data-backtothetop-fixed-bottom="10"
 data-backtothetop-fixed-right="20">
<span class="fa-layers fa-fw">
<i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i>
</span></a>

<script src="https://thekoguryo.github.io/oci-cloudnative/js/copy-code-button.js"></script></div>
</body>
</html>
