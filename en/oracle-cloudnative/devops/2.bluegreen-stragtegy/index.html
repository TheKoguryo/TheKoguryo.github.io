<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>3.2 Deploying with a Blue/Green Deployment Strategy for DevOps Services - TheKoguryo's Tech Blog</title><meta name=generator content="Hugo 0.111.3"><link href=https://thekoguryo.github.io/index.xml rel=alternate type=application/rss+xml><link rel=canonical href=https://thekoguryo.github.io/en/oracle-cloudnative/devops/2.bluegreen-stragtegy/><link rel=stylesheet href=https://thekoguryo.github.io/css/theme.min.css><link rel=stylesheet href=https://thekoguryo.github.io/css/d2coding.css><link rel=stylesheet href=https://thekoguryo.github.io/css/fontawesome-all.min.css><script src=https://use.fontawesome.com/releases/v5.15.4/js/all.js></script>
<link rel=stylesheet href=https://thekoguryo.github.io/css/chroma.min.css><script src=https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js></script>
<script src=https://thekoguryo.github.io/js/functions.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js></script>
<script src=https://thekoguryo.github.io/js/jquery.backtothetop/jquery.backtothetop.min.js></script>
<script src=https://thekoguryo.github.io/js/jqcloud/jqcloud.js></script>
<link rel=stylesheet href=https://thekoguryo.github.io/js/jqcloud/jqcloud.css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-106207316-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-106207316-1")</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2708881668962858" crossorigin=anonymous></script><meta property="og:title" content="3.2 Deploying with a Blue/Green Deployment Strategy for DevOps Services"><meta property="og:description" content="3.2 Deploying with a Blue/Green Deployment Strategy for DevOps Services Automating CI/CD deployment through DevOps service Prerequisites Refer to 4.1.1 Installing NGINX Ingress Controller to install Nginx Ingress Controller in advance. Create a DevOps project Use the previously created project as it is, or create a new one.
Automating application deployment Use Code Repository to Manage Application Code As a sample, we will create and test our pre-made Nginx-based web app."><meta property="og:type" content="article"><meta property="og:url" content="https://thekoguryo.github.io/en/oracle-cloudnative/devops/2.bluegreen-stragtegy/"><meta property="article:section" content="oracle-cloudnative"><meta property="article:published_time" content="2022-04-20T00:00:00+00:00"><meta property="article:modified_time" content="2022-04-20T00:00:00+00:00"><meta property="og:site_name" content="TheKoguryo's Tech Blog"></head><body><div class=container><header><h1>TheKoguryo's Tech Blog</h1><span class=version>&nbsp;Version 2023.11.19</span>
<a href=https://github.com/TheKoguryo class=github><i class="fab fa-github"></i></a></header><div class=menu><nav><ul><li><a href=/>Home</a></li><li><a href=/release-notes>OCI Release Notes</a></li><li><a href=/archives>Archives</a></li><li><a href=/tags>Tag</a></li><li><a href=https://github.com/TheKoguryo/TheKoguryo.github.io/issues/new>Feedback</a></li><li><a href=/link>Link</a></li><li style=float:right><a href=https://thekoguryo.github.io/oracle-cloudnative/devops/2.bluegreen-stragtegy/>한국어</a></li></ul></nav></div><div class=content-container><main><div class="panel panel-caution"><div class=panel-header><h3><svg class="svg-inline--fa fa-life-saver fa-w-16" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="life-saver" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><g><path fill="currentcolor" d="M156.5 447.7l-12.6 29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7c12.5 10.9 26.4 20.4 41.4 28.1zM40.6 272H8.5c1.4 21.2 5.4 41.7 11.7 61.1L50 321.2c-4.9-15.7-8.2-32.2-9.4-49.2zm0-32c1.4-18.8 5.2-37 11.1-54.1l-29.5-12.6C14.7 194.3 10 216.7 8.5 240H40.6zm23.7-83.5c7.8-14.9 17.2-28.8 28.1-41.5L69.7 92.3c-13.7 15.6-25.5 32.8-34.9 51.5l29.5 12.7zM397 419.6c-13.9 12-29.4 22.3-46.1 30.4l11.9 29.8c20.7-9.9 39.8-22.6 56.9-37.6L397 419.6zM115 92.4c13.9-12 29.4-22.3 46.1-30.4l-11.9-29.8c-20.7 9.9-39.8 22.6-56.8 37.6L115 92.4zM447.7 355.5c-7.8 14.9-17.2 28.8-28.1 41.5l22.7 22.7c13.7-15.6 25.5-32.9 34.9-51.5L447.7 355.5zM471.4 272c-1.4 18.8-5.2 37-11.1 54.1l29.5 12.6c7.5-21.1 12.2-43.5 13.6-66.8h-32zM321.2 462c-15.7 5-32.2 8.2-49.2 9.4v32.1c21.2-1.4 41.7-5.4 61.1-11.7L321.2 462zM240 471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6 29.5c21.1 7.5 43.5 12.2 66.8 13.6v-32zM462 190.8c5 15.7 8.2 32.2 9.4 49.2h32.1c-1.4-21.2-5.4-41.7-11.7-61.1L462 190.8zM92.4 397c-12-13.9-22.3-29.4-30.4-46.1l-29.8 11.9c9.9 20.7 22.6 39.8 37.6 56.9L92.4 397zM272 40.6c18.8 1.4 36.9 5.2 54.1 11.1l12.6-29.5C317.7 14.7 295.3 10 272 8.5V40.6zM190.8 50c15.7-5 32.2-8.2 49.2-9.4V8.5c-21.2 1.4-41.7 5.4-61.1 11.7L190.8 50zM442.3 92.3 419.6 115c12 13.9 22.3 29.4 30.5 46.1l29.8-11.9C470 128.5 457.3 109.4 442.3 92.3zM397 92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6 29.5C370.4 72.1 384.4 81.5 397 92.4z"/><circle fill="currentcolor" cx="256" cy="364" r="28"><animate attributeType="XML" repeatCount="indefinite" dur="2s" attributeName="r" values="28;14;28;28;14;28;"/><animate attributeType="XML" repeatCount="indefinite" dur="2s" attributeName="opacity" values="1;0;1;1;0;1;"/></circle><path fill="currentcolor" opacity="1" d="M263.7 312h-16c-6.6.0-12-5.4-12-12 0-71 77.4-63.9 77.4-107.8.0-20-17.8-40.2-57.4-40.2-29.1.0-44.3 9.6-59.2 28.7-3.9 5-11.1 6-16.2 2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2 21.2-27.2 46.4-44.7 91.2-44.7 52.3.0 97.4 29.8 97.4 80.2.0 67.6-77.4 63.5-77.4 107.8C275.7 306.6 270.3 312 263.7 312z"><animate attributeType="XML" repeatCount="indefinite" dur="2s" attributeName="opacity" values="1;0;0;0;0;1;"/></path><path fill="currentcolor" opacity="0" d="M232.5 134.5l7 168c.3 6.4 5.6 11.5 12 11.5h9c6.4.0 11.7-5.1 12-11.5l7-168c.3-6.8-5.2-12.5-12-12.5h-23C237.7 122 232.2 127.7 232.5 134.5z"><animate attributeType="XML" repeatCount="indefinite" dur="2s" attributeName="opacity" values="0;0;1;1;0;0;"/></path></g></svg>Warning</h3></div><div class=panel-body><p>This content has been generated by machine translation. The translations are automated and have not undergone human review or validation.</p></div></div><h1 id=32-deploying-with-a-bluegreen-deployment-strategy-for-devops-services>3.2 Deploying with a Blue/Green Deployment Strategy for DevOps Services</h1><h2 id=automating-cicd-deployment-through-devops-service>Automating CI/CD deployment through DevOps service</h2><h3 id=prerequisites>Prerequisites</h3><ul><li>Refer to <a href=../../oss/ingress-controller/1.install-nginx-ingress-controller/>4.1.1 Installing NGINX Ingress Controller</a> to install Nginx Ingress Controller in advance.</li></ul><h3 id=create-a-devops-project>Create a DevOps project</h3><p>Use the previously created project as it is, or create a new one.</p><h3 id=automating-application-deployment>Automating application deployment</h3><h4 id=use-code-repository-to-manage-application-code>Use Code Repository to Manage Application Code</h4><p>As a sample, we will create and test our pre-made Nginx-based web app.</p><ol><li><p>Click <strong>Code Repositories</strong> in the left menu to create a code repository.</p></li><li><p>Click <strong>Create repository</strong> to create the repository.</p><ul><li>Repository name: ex) oci-devops-oke-webpage</li></ul></li><li><p>The actual development work can be done on the development PC through the git command. If you click the <strong>Clone</strong> button above the repository details, the Clone command will appear as shown below. We will use <strong>Clone with HTTPS</strong> here.</p></li><li><p>Using the copied address on the development PC, clone it through the git clone command.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone &lt;YourClonewithHTTPS URL&gt;
</span></span></code></pre></div></li><li><p>User authentication is required at this time. For HTTPS-based user authentication, the following user name format and AuthToken are used.</p></li><li><p>Bring the already developed source and move it to the cloned repository.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wget https://github.com/TheKoguryo/oci-devops-oke-webpage/archive/refs/tags/v2022.04.tar.gz
</span></span><span class=line><span class=cl>tar -xvzf v2022.04.tar.gz --strip-components<span class=o>=</span><span class=m>1</span> -C oci-devops-oke-webpage/
</span></span></code></pre></div></li><li><p>Push the code to the Code Repository.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> oci-devops-oke-webpage
</span></span><span class=line><span class=cl>git add .
</span></span><span class=line><span class=cl>git commit -m <span class=s2>&#34;init&#34;</span>
</span></span><span class=line><span class=cl>git push
</span></span></code></pre></div></li><li><p>Completion of code writing and reflection</p><ul><li>Dockerfile, default.conf.template, html folder: This is the source file to build the image of the nginx-based web app.</li><li>build_spec.yaml: This is the build definition used in the build stage of the DevOps service.</li><li>oci-oke-deployment.yaml: Kubernetes Manifest file defined for deployment to OKE. I will explain it again later.</li></ul><p><img class=img-fluid1 src=../images/image-20220420164127962.png alt=image-20220420164127962 onerror='this.onerror=null,this.src="images/image-20220420164127962.png"'></p></li></ol><h4 id=create-a-build-pipeline>Create a Build Pipeline</h4><p>It is possible to configure the part corresponding to the CI process that builds code during CI/CD to create deployment artifacts through Build Pipeline.</p><ol><li><p>Go to <strong>Projects page</strong> and go to <strong>Build Pipelines</strong> in the left menu.</p></li><li><p>Click <strong>Create build pipeline</strong> to create the pipeline.</p><ul><li>Name: Ex) webpage-build-pipeline</li></ul></li><li><p>Click the created pipeline.</p></li><li><p>You can configure the pipeline flow by adding Stages as shown. Click <strong>Add Stage</strong>.</p></li></ol><h5 id=create-a-build-stage>Create a Build Stage</h5><ol><li><p>First add <strong>Managed Build</strong> Stage for build.</p></li><li><p>Managed Build Stage Setup</p><ul><li><p><strong>Stage name</strong>: Ex) build-stage</p></li><li><p><strong>Build Spec File Path</strong>: Specifies the build script path. By default, it uses the build_spec.yaml file in the source root.</p></li><li><p><strong>Primary Code Repository</strong>: Specifies the code repository with the main source to build.</p><ul><li><p>Specifies the repository where the target source code is located.</p><p><img class=img-fluid1 src=../images/image-20220420165218490.png alt=image-20220420165218490 onerror='this.onerror=null,this.src="images/image-20220420165218490.png"'></p></li></ul></li></ul></li><li><p>Click <strong>Add</strong> to add the set Stage.</p></li><li><p>The definition of Build Spec in the source code is necessary like a test.</p><ul><li><p>We have already defined build_spec.yaml in the root path of the developed oci-devops-oke-webpage source code. Check what you have defined.</p></li><li><p>build_spec.yaml</p><ul><li>outputArtifacts.output-image: refers to the container image that is the build artifact.</li><li>outputArtifacts.output-oci-oke-deployment: Manifest file for OKE deployment in the source code as a build artifact.</li><li>exportedVariables<ul><li>IMAGE_PATH: Calculates the OCIR repository based on the built environment information and APP_NAME.</li><li>TAG: For convenience, it is specified as a code Commit ID or BUILD_ID hash value.</li></ul></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>0.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>component</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>timeoutInSeconds</span><span class=p>:</span><span class=w> </span><span class=m>6000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>runAs</span><span class=p>:</span><span class=w> </span><span class=l>root</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>shell</span><span class=p>:</span><span class=w> </span><span class=l>bash</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># these are local variables to the build config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>variables</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>defaultAppName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;webpage&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>defaultContextPath</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/webpage&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># the value of a vaultVariable is the secret-id (in OCI ID format) stored in the OCI Vault service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># you can then access the value of that secret in your build_spec.yaml commands</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>vaultVariables</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># exportedVariables are made available to use as parameters in sucessor Build Pipeline stages</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># For this Build to run, the Build Pipeline needs to have a BUILDRUN_HASH parameter set</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>exportedVariables</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>BUILDRUN_HASH</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>APP_NAME</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>IMAGE_PATH</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>TAG</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>CONTEXT_PATH</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Its a native way to fetch artifacts from external or artifact repo or a file path to use before a stage.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># More about buildspec formats - https://docs.oracle.com/en-us/iaas/Content/devops/using/build_specs.htm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>inputArtifacts</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Command</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Init exportedVariables&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>timeoutInSeconds</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>      APP_NAME=$defaultAppName
</span></span></span><span class=line><span class=cl><span class=sd>      CONTEXT_PATH=$defaultContextPath
</span></span></span><span class=line><span class=cl><span class=sd>      echo $APP_NAME
</span></span></span><span class=line><span class=cl><span class=sd>      echo $CONTEXT_PATH</span><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Command</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Build Source&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>timeoutInSeconds</span><span class=p>:</span><span class=w> </span><span class=m>4000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>      echo no action</span><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Command</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Define Image Tag - Commit ID&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>timeoutInSeconds</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>      COMMIT_ID=`echo ${OCI_TRIGGER_COMMIT_HASH} | cut -c 1-7`
</span></span></span><span class=line><span class=cl><span class=sd>      BUILDRUN_HASH=`echo ${OCI_BUILD_RUN_ID} | rev | cut -c 1-7`
</span></span></span><span class=line><span class=cl><span class=sd>      [ -z &#34;$COMMIT_ID&#34; ] &amp;&amp; TAG=$BUILDRUN_HASH || TAG=$COMMIT_ID</span><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Command</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Define Image Path&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>timeoutInSeconds</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>      TENANCY_NAMESPACE=`oci os ns get --query data --raw-output`
</span></span></span><span class=line><span class=cl><span class=sd>      REPO_NAME=$APP_NAME
</span></span></span><span class=line><span class=cl><span class=sd>      IMAGE_PATH=$OCI_RESOURCE_PRINCIPAL_REGION.ocir.io/$TENANCY_NAMESPACE/$REPO_NAME</span><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Command</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>timeoutInSeconds</span><span class=p>:</span><span class=w> </span><span class=m>1200</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Build Container Image&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>      cd ${OCI_PRIMARY_SOURCE_DIR}
</span></span></span><span class=line><span class=cl><span class=sd>      docker build --pull --rm -t new-generated-image . --build-arg CONTEXT_PATH=$CONTEXT_PATH</span><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Command</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Check exportedVariables&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>timeoutInSeconds</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=l>|  </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>[</span><span class=w> </span>-<span class=l>z &#34;$APP_NAME&#34; ] &amp;&amp; APP_NAME=unknown          </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>[</span><span class=w> </span>-<span class=l>z &#34;$IMAGE_PATH&#34; ] &amp;&amp; IMAGE_PATH=unknown    </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>[</span><span class=w> </span>-<span class=l>z &#34;$TAG&#34; ] &amp;&amp; TAG=unknown</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=l>echo &#34;APP_NAME: &#34; $APP_NAME      </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=l>echo &#34;IMAGE_PATH: &#34; $IMAGE_PATH</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=l>echo &#34;TAG: &#34; $TAG</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>outputArtifacts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>output-image</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>DOCKER_IMAGE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># this location tag doesn&#39;t effect the tag used to deliver the container image</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># to the Container Registry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>location</span><span class=p>:</span><span class=w> </span><span class=l>new-generated-image</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>output-oci-oke-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>BINARY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>location</span><span class=p>:</span><span class=w> </span><span class=l>${OCI_PRIMARY_SOURCE_DIR}/oci-oke-deployment.yaml      </span><span class=w>
</span></span></span></code></pre></div></li></ul></li><li><p>Configuration of Build Stage is completed</p></li></ol><h5 id=create-an-artifact-repository-to-store-build-artifacts>Create an Artifact repository to store build artifacts</h5><ol><li>Go to <strong>Developer Services</strong> > <strong>Containers & Artifacts</strong> > <strong>Artifact Registry</strong> from the top left hamburger menu.</li><li>Click <strong>Create repository</strong> to add a repository.<ul><li>Name: Ex) oci-hol-artifact-repository</li><li>Immutable artifacts: unchecked for testing</li></ul></li></ol><h5 id=saving-build-artifacts-to-ocir-and-artifact-repositories>Saving build artifacts to OCIR and Artifact repositories</h5><ol><li><p>Go to the Build Pipeline tab.</p></li><li><p>Click the plus button to add a stage after build-stage.</p></li><li><p>Select <strong>Delivery Artifact</strong> Stage.</p></li><li><p>Enter a stage name and choose Create Artifact.</p><p><img class=img-fluid1 src=../images/image-20220420171453459.png alt=image-20220420171453459 onerror='this.onerror=null,this.src="images/image-20220420171453459.png"'></p></li><li><p>Add Artifact as Container image type.</p><ul><li><p>Image path: Image path used when attaching docker tag. You can enter it directly, but here, use the exportedVariable passed from the build-stage and enter it as follows.</p><ul><li>Name: generated_image_with_tag</li><li>Image Path: ${IMAGE_PATH}:${TAG}</li></ul><p><img class=img-fluid1 src=../images/image-20220420171635825.png alt=image-20220420171635825 onerror='this.onerror=null,this.src="images/image-20220420171635825.png"'></p></li></ul></li><li><p>Add one more in the same way.</p><ul><li>Name: generated_image_with_latest</li><li>Image Path: ${IMAGE_PATH}:latest</li></ul></li><li><p>Add the Kubernetes Manifest file to the Artifact Repository you created earlier.</p><ul><li><p>Name: Ex) oci-oke-deployment.yaml</p></li><li><p>Artifact path: oci-devops-oke-webpage/oci-oke-deployment.yaml</p></li><li><p>Version: ${BUILDRUN_HASH}</p><p><img class=img-fluid1 src=../images/image-20220420184107716.png alt=image-20220420184107716 onerror='this.onerror=null,this.src="images/image-20220420184107716.png"'></p></li></ul></li><li><p>Artifact Mapping</p><ul><li><p>Associate Artifact maps the actual container image files to the 3 Artifacts you just added. Enter the name of the outputArtifacts defined in build_spec.yaml earlier in build-stage.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>outputArtifacts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>output-image</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>DOCKER_IMAGE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># this location tag doesn&#39;t effect the tag used to deliver the container image</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># to the Container Registry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>location</span><span class=p>:</span><span class=w> </span><span class=l>new-generated-image</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>output-oci-oke-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>BINARY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>location</span><span class=p>:</span><span class=w> </span><span class=l>${OCI_PRIMARY_SOURCE_DIR}/oci-oke-deployment.yaml</span><span class=w>
</span></span></span></code></pre></div><p><img class=img-fluid1 src=../images/image-20220421102046463.png alt=image-20220421102046463 onerror='this.onerror=null,this.src="images/image-20220421102046463.png"'></p></li></ul></li><li><p>Now we have added the delivery stage.</p></li></ol><h4 id=create-bluegreen-deployment-pipeline>Create Blue/Green Deployment Pipeline</h4><p>It is possible to configure the part corresponding to the CD process of distributing the products built during CI/CD to the actual server through the Deployment Pipeline.</p><p>Deploying to Kubernetes with the Blue/Green strategy requires two things: a deployment environment, a Kubernetes Manifest file to deploy, and a Kubernetes Namespace to be used for deployment.</p><h5 id=registering-the-kubernetes-environment>Registering the Kubernetes Environment</h5><ol><li>If there is no OKE environment registered previously, go to <strong>Project page</strong> and go to <strong>Environments</strong> in the left menu to register OKE environment to deploy.</li></ol><h5 id=prepare-the-manifest-file-for-deployment-to-kubernetes>Prepare the manifest file for deployment to Kubernetes</h5><ol><li><p>To use the stage type to deploy to Kubernetes, you need to prepare the manifest yaml file for deployment in advance.</p></li><li><p>As in the previous exercise, there is a way to do it in inline format, or you can manage and use the Kubernetes Manifest file in the source project file imported earlier in this time.</p><ul><li><p>Sample Manifest file to use</p><ul><li>Deployment, Service: Deployment and cluster IP-based service to deploy the built container app</li><li>Ingress: Required for Blue/Green or Canary deployments. Both provide this function by adjusting routing rules based on the Nginx Ingress Controller.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>${APP_NAME}-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>${APP_NAME}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>${APP_NAME}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>${APP_NAME}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=c># enter the path to your image, be sure to include the correct region prefix</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>${IMAGE_PATH}:${TAG}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>readinessProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>exec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span>- <span class=l>cat</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c># For demo, see the start status easily about rolling updates.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>livenessProbe</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>exec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span>- <span class=l>cat</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>POD_NAMESPACE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>fieldRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>fieldPath</span><span class=p>:</span><span class=w> </span><span class=l>metadata.namespace</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>${APP_NAME}-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ClusterIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>${APP_NAME}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>networking.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Ingress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>${APP_NAME}-ingress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>kubernetes.io/ingress.class</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;nginx&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>nginx.ingress.kubernetes.io/rewrite-target</span><span class=p>:</span><span class=w> </span><span class=l>/$2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>${CONTEXT_PATH}(/|$)(.*)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>pathType</span><span class=p>:</span><span class=w> </span><span class=l>Prefix</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>backend</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>${APP_NAME}-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>port</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>number</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span></code></pre></div></li></ul></li></ol><h5 id=create-a-namespace-to-deploy-to-kubernetes>Create a namespace to deploy to Kubernetes</h5><p>We need the namespace where the blue app will be deployed and the namespace where the green app will be deployed. The current version and new version of the same app will be deployed in each namespace, and traffic is controlled through routing settings.</p><ol><li><p>Connect to the environment where the kubectl command can be executed through Cloud Shell.</p></li><li><p>Create two namespaces.</p><ul><li><p>Ex) ns-blue, ns-green</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create ns ns-blue
</span></span><span class=line><span class=cl>kubectl create ns ns-green
</span></span></code></pre></div></li></ul></li><li><p>Import images from OCIR</p><blockquote><p>If OCIR repository land (eg, webpage) does not exist in advance, it is created in a private form in the Root Compartment. To import from OKE, either create an imagepullsecret in each namespace in advance, or create a public repository in advance.</p></blockquote></li></ol><h5 id=creating-a-kubernetes-deployment-stage-with-bluegreen-strategy>Creating a Kubernetes Deployment Stage with Blue/Green Strategy</h5><ol><li><p>Go to <strong>Projects page</strong> and go to <strong>Deployment Pipelines</strong> in the left menu.</p></li><li><p>Click <strong>Create pipeline</strong> to create the pipeline.</p><ul><li>Name: Ex) webpage-bluegreen-deployment-pipeline</li></ul></li><li><p>Click the created pipeline to add the <strong>Blue/Green Strategy</strong> Stage.</p><p><img class=img-fluid1 src=../images/image-20220420185718429.png alt=image-20220420185718429 onerror='this.onerror=null,this.src="images/image-20220420185718429.png"'></p></li><li><p>Select the deployment type as OKE, and select the deployment environment and manifest file.</p></li><li><p>Make additional settings for Blue/Green deployment.</p><ul><li><p><strong>Namespace set</strong>: Enter the two namespaces for the deployment you will create earlier. The order of the two doesn&rsquo;t really matter, just deploy where the old version is, and redirect traffic to the current version to where the new version is.</p><ul><li>Ex) ns-blue, ns-green</li></ul></li><li><p><strong>NGINX ingress namespace</strong>: Enter the ingress resource name of the deployment app defined in the deployment manifest file.</p></li></ul><p><img class=img-fluid1 src=../images/image-20220421094407123.png alt=image-20220421094407123 onerror='this.onerror=null,this.src="images/image-20220421094407123.png"'></p></li><li><p>Set Options: Enable Approval controls. It automatically proceeds only to deployment, and after approval, add it to divert traffic. You can think of it as a traffic changeover switch.</p><ul><li><p>Approval controls:</p><ul><li>Name: Ex) approval-stage</li></ul><p><img class=img-fluid1 src=../images/image-20220421094756223.png alt=image-20220421094756223 onerror='this.onerror=null,this.src="images/image-20220421094756223.png"'></p></li></ul></li><li><p>Pipeline Completion</p><p><img class=img-fluid1 src=../images/image-20220421094951551.png alt=image-20220421094951551 onerror='this.onerror=null,this.src="images/image-20220421094951551.png"'></p></li></ol><h4 id=calling-deployment-pipeline-from-build-pipeline>Calling Deployment Pipeline from Build Pipeline</h4><p>After the Build Pipeline we created earlier is finished, we add a call to the Deployment Pipeline so that it can be deployed.</p><ol><li><p>Go to the <strong>Build Pipelines</strong> you created earlier.</p></li><li><p>Add a Stage to the end of the pipeline.</p></li><li><p>Select the <strong>Trigger Deployment</strong> type.</p></li><li><p>Specify the Deployment Pipeline for the Blue/Green deployment we created earlier.</p></li><li><p>The whole flow of post-build deployment is complete.</p></li></ol><h4 id=setting-trigger>Setting Trigger</h4><p>The build and deployment pipeline needs to work automatically when the developer applies the code to the code repository. Triggers are responsible for starting the build pipeline through events that occur in the code repository.</p><ol><li><p>Go to <strong>Project Page</strong> and go to <strong>Trigger</strong> in the left menu.</p></li><li><p>Click <strong>Create trigger</strong>.</p></li><li><p>Set the trigger.</p><ul><li><strong>Name</strong>: Ex) webpage-build-pipeline-trigger</li><li><strong>Source Code Repository</strong>: Select oci-devops-oke-webpage on the OCI Code Repository created earlier.</li><li><strong>Actions</strong>: Select webpage-pipeline, which is a build pipeline created with actions that are called when triggered.</li></ul></li><li><p>Setup is complete.</p></li></ol><h4 id=test---blue-deployment>Test - Blue Deployment</h4><ol><li><p>Random changes are made to the oci-devops-oke-webpage source code specified in Trigger and reflected in the Code Repository.</p></li><li><p>Go to Cloud Shell with the code you are working on.</p></li><li><p>You can change html/index.html, but for convenience, change the Dockerfile set as an environment variable.</p></li><li><p>Changes are made based on the current setting, and the code is committed and then pushed.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>FROM nginx:alpine
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>COPY default.conf.template /etc/nginx/templates/
</span></span><span class=line><span class=cl>COPY html/ /usr/share/nginx/html/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ENV <span class=nv>POD_NAMESPACE</span><span class=o>=</span><span class=s2>&#34;default&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ENV <span class=nv>VERSION</span><span class=o>=</span><span class=s2>&#34;1.0&#34;</span>
</span></span><span class=line><span class=cl>ENV <span class=nv>MESSAGE</span><span class=o>=</span><span class=s2>&#34;Hello OCI DevOps&#34;</span>
</span></span><span class=line><span class=cl>ENV <span class=nv>BACKGROUND</span><span class=o>=</span><span class=s2>&#34;blue&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ARG <span class=nv>CONTEXT_PATH</span><span class=o>=</span><span class=s2>&#34;/webpage&#34;</span>
</span></span><span class=line><span class=cl>ENV <span class=nv>CONTEXT_PATH</span><span class=o>=</span><span class=nv>$CONTEXT_PATH</span>
</span></span></code></pre></div></li><li><p>It becomes a Trigger and the build starts.</p><p><img class=img-fluid1 src=../images/image-20220421102411179.png alt=image-20220421102411179 onerror='this.onerror=null,this.src="images/image-20220421102411179.png"'></p></li><li><p>The build succeeds, the deployment pipeline runs, and waits in approval-stage.</p><p><img class=img-fluid1 src=../images/image-20220421102841459.png alt=image-20220421102841459 onerror='this.onerror=null,this.src="images/image-20220421102841459.png"'></p></li><li><p>Check the Kubernetes deployment status. You can see that it is deployed only to ns-blue.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>opc@jumpbox-945115 ~<span class=o>]</span>$ kubectl get all,ingress -n ns-blue
</span></span><span class=line><span class=cl>NAME                                      READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>pod/webpage-deployment-6fbfd769c7-gqprs   1/1     Running   <span class=m>0</span>          9m28s
</span></span><span class=line><span class=cl>pod/webpage-deployment-6fbfd769c7-m4lk4   1/1     Running   <span class=m>0</span>          9m28s
</span></span><span class=line><span class=cl>pod/webpage-deployment-6fbfd769c7-z924h   1/1     Running   <span class=m>0</span>          9m28s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                      TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>    AGE
</span></span><span class=line><span class=cl>service/webpage-service   ClusterIP   10.96.166.161   &lt;none&gt;        8080/TCP   9m28s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                 READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>deployment.apps/webpage-deployment   3/3     <span class=m>3</span>            <span class=m>3</span>           9m28s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                            DESIRED   CURRENT   READY   AGE
</span></span><span class=line><span class=cl>replicaset.apps/webpage-deployment-6fbfd769c7   <span class=m>3</span>         <span class=m>3</span>         <span class=m>3</span>       9m28s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                        CLASS    HOSTS   ADDRESS          PORTS   AGE
</span></span><span class=line><span class=cl>ingress.networking.k8s.io/webpage-ingress   &lt;none&gt;   *       146.56.118.147   <span class=m>80</span>      9m28s
</span></span><span class=line><span class=cl><span class=o>[</span>opc@jumpbox-945115 ~<span class=o>]</span>$ kubectl get all,ingress -n ns-green
</span></span><span class=line><span class=cl>No resources found in ns-green namespace.
</span></span></code></pre></div></li><li><p>Return to the running deployment pipeline and approve in approval-stage.</p><p><img class=img-fluid1 src=../images/image-20220421103948397.png alt=image-20220421103948397 onerror='this.onerror=null,this.src="images/image-20220421103948397.png"'></p><p><img class=img-fluid1 src=../images/image-20220421104100911.png alt=image-20220421104100911 onerror='this.onerror=null,this.src="images/image-20220421104100911.png"'></p></li><li><p>If approved, Traffic Shift is also performed, and you can see that the ingress is also distributed in ns-green. However, now that ns-blue is Active, if you look at the annotations of webpage-ingress in ns-green, it becomes <strong>canary-weight:</strong> &ldquo;<strong>0</strong>&rdquo;. In fact, the request does not go to ns-green. .</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>opc@jumpbox-945115 ~<span class=o>]</span>$ kubectl get all,ingress -n ns-green
</span></span><span class=line><span class=cl>NAME                                        CLASS    HOSTS   ADDRESS          PORTS   AGE
</span></span><span class=line><span class=cl>ingress.networking.k8s.io/webpage-ingress   &lt;none&gt;   *       146.56.118.147   <span class=m>80</span>      4m
</span></span><span class=line><span class=cl><span class=o>[</span>opc@jumpbox-945115 ~<span class=o>]</span>$ kubectl get ingress webpage-ingress -n ns-green -o yaml
</span></span><span class=line><span class=cl>apiVersion: networking.k8s.io/v1
</span></span><span class=line><span class=cl>kind: Ingress
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  annotations:
</span></span><span class=line><span class=cl>    kubernetes.io/ingress.class: nginx
</span></span><span class=line><span class=cl>    nginx.ingress.kubernetes.io/canary: <span class=s2>&#34;true&#34;</span>
</span></span><span class=line><span class=cl>    nginx.ingress.kubernetes.io/canary-by-header: redirect-to-namespaceB
</span></span><span class=line><span class=cl>    nginx.ingress.kubernetes.io/canary-weight: <span class=s2>&#34;0&#34;</span>
</span></span><span class=line><span class=cl>    nginx.ingress.kubernetes.io/rewrite-target: /<span class=nv>$2</span>
</span></span><span class=line><span class=cl>...
</span></span></code></pre></div></li><li><p>If you access the webpage through the Ingress address, you can see that the Blue app is currently working well.</p><ul><li>Address example) http://146.56.118.147/webpage</li></ul><p><img class=img-fluid1 src=../images/image-20220421105020566.png alt=image-20220421105020566 onerror='this.onerror=null,this.src="images/image-20220421105020566.png"'></p></li></ol><h4 id=test---green-deployment>Test - Green Deployment</h4><ol><li><p>Go back to the source and change the code (e.g., change the environment variable of Dockerfile) and apply the code by Commit & Push</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>FROM nginx:alpine
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>COPY default.conf.template /etc/nginx/templates/
</span></span><span class=line><span class=cl>COPY html/ /usr/share/nginx/html/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ENV <span class=nv>POD_NAMESPACE</span><span class=o>=</span><span class=s2>&#34;default&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ENV <span class=nv>VERSION</span><span class=o>=</span><span class=s2>&#34;1.1&#34;</span>
</span></span><span class=line><span class=cl>ENV <span class=nv>MESSAGE</span><span class=o>=</span><span class=s2>&#34;Hello OCI DevOps&#34;</span>
</span></span><span class=line><span class=cl>ENV <span class=nv>BACKGROUND</span><span class=o>=</span><span class=s2>&#34;green&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ARG <span class=nv>CONTEXT_PATH</span><span class=o>=</span><span class=s2>&#34;/webpage&#34;</span>
</span></span><span class=line><span class=cl>ENV <span class=nv>CONTEXT_PATH</span><span class=o>=</span><span class=nv>$CONTEXT_PATH</span>
</span></span></code></pre></div></li><li><p>Rebuild, wait for the deployment pipeline to run and stop at approval-stage.</p></li><li><p>Check the Kubernetes deployment status. You can see the app deployed to ns-green.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>opc@jumpbox-945115 ~<span class=o>]</span>$ kubectl get all,ingress -n ns-blue
</span></span><span class=line><span class=cl>NAME                                      READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>pod/webpage-deployment-6fbfd769c7-gqprs   1/1     Running   <span class=m>0</span>          34m
</span></span><span class=line><span class=cl>pod/webpage-deployment-6fbfd769c7-m4lk4   1/1     Running   <span class=m>0</span>          34m
</span></span><span class=line><span class=cl>pod/webpage-deployment-6fbfd769c7-z924h   1/1     Running   <span class=m>0</span>          34m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                      TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>    AGE
</span></span><span class=line><span class=cl>service/webpage-service   ClusterIP   10.96.166.161   &lt;none&gt;        8080/TCP   34m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                 READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>deployment.apps/webpage-deployment   3/3     <span class=m>3</span>            <span class=m>3</span>           34m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                            DESIRED   CURRENT   READY   AGE
</span></span><span class=line><span class=cl>replicaset.apps/webpage-deployment-6fbfd769c7   <span class=m>3</span>         <span class=m>3</span>         <span class=m>3</span>       34m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                        CLASS    HOSTS   ADDRESS          PORTS   AGE
</span></span><span class=line><span class=cl>ingress.networking.k8s.io/webpage-ingress   &lt;none&gt;   *       146.56.118.147   <span class=m>80</span>      34m
</span></span><span class=line><span class=cl><span class=o>[</span>opc@jumpbox-945115 ~<span class=o>]</span>$ kubectl get all,ingress -n ns-green
</span></span><span class=line><span class=cl>NAME                                      READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>pod/webpage-deployment-75c8bb6ffc-5b497   1/1     Running   <span class=m>0</span>          98s
</span></span><span class=line><span class=cl>pod/webpage-deployment-75c8bb6ffc-m8dl4   1/1     Running   <span class=m>0</span>          98s
</span></span><span class=line><span class=cl>pod/webpage-deployment-75c8bb6ffc-xctr4   1/1     Running   <span class=m>0</span>          98s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                      TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>    AGE
</span></span><span class=line><span class=cl>service/webpage-service   ClusterIP   10.96.153.34   &lt;none&gt;        8080/TCP   98s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                 READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>deployment.apps/webpage-deployment   3/3     <span class=m>3</span>            <span class=m>3</span>           98s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                            DESIRED   CURRENT   READY   AGE
</span></span><span class=line><span class=cl>replicaset.apps/webpage-deployment-75c8bb6ffc   <span class=m>3</span>         <span class=m>3</span>         <span class=m>3</span>       98s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                        CLASS    HOSTS   ADDRESS          PORTS   AGE
</span></span><span class=line><span class=cl>ingress.networking.k8s.io/webpage-ingress   &lt;none&gt;   *       146.56.118.147   <span class=m>80</span>      18m
</span></span></code></pre></div></li><li><p>If you access the webpage, you will still be connected to the Blue app.</p></li><li><p>Go back to the running deployment pipeline and approve in approval-stage.</p></li><li><p>If approved, it becomes Traffic Shift. Now that ns-green is Active, you can see that it has been changed to <strong>canary-weight:</strong> &ldquo;<strong>100</strong>&rdquo; in the annotations of webpage-ingress in ns-green. Now all requests are only forwarded to ns-green.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>opc@jumpbox-945115 ~<span class=o>]</span>$ kubectl get ingress webpage-ingress -n ns-green -o yaml
</span></span><span class=line><span class=cl>apiVersion: networking.k8s.io/v1
</span></span><span class=line><span class=cl>kind: Ingress
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  annotations:
</span></span><span class=line><span class=cl>    kubernetes.io/ingress.class: nginx
</span></span><span class=line><span class=cl>    nginx.ingress.kubernetes.io/canary: <span class=s2>&#34;true&#34;</span>
</span></span><span class=line><span class=cl>    nginx.ingress.kubernetes.io/canary-by-header: redirect-to-namespaceB
</span></span><span class=line><span class=cl>    nginx.ingress.kubernetes.io/canary-weight: <span class=s2>&#34;100&#34;</span>
</span></span><span class=line><span class=cl>    nginx.ingress.kubernetes.io/rewrite-target: /<span class=nv>$2</span>
</span></span><span class=line><span class=cl>...
</span></span></code></pre></div></li><li><p>When you access the web page, you will be connected to the Green app. Even if you request repeatedly several times, you will be connected to the Green app.</p><p><img class=img-fluid1 src=../images/image-20220421110959032.png alt=image-20220421110959032 onerror='this.onerror=null,this.src="images/image-20220421110959032.png"'></p></li></ol><h4 id=test---deploy-additional-changes---red-deploy>Test - Deploy Additional Changes - Red Deploy</h4><ol><li><p>Go back to the source and change the code (e.g., change the environment variable of Dockerfile) and apply the code by Commit & Push</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>ENV <span class=nv>VERSION</span><span class=o>=</span><span class=s2>&#34;1.2&#34;</span>
</span></span><span class=line><span class=cl>ENV <span class=nv>MESSAGE</span><span class=o>=</span><span class=s2>&#34;Hello OCI DevOps&#34;</span>
</span></span><span class=line><span class=cl>ENV <span class=nv>BACKGROUND</span><span class=o>=</span><span class=s2>&#34;red&#34;</span>
</span></span><span class=line><span class=cl>...
</span></span></code></pre></div></li><li><p>Rebuild, wait for the deployment pipeline to run and stop at approval-stage.</p></li><li><p>Check the Kubernetes deployment status. If you look at the AGE of the POD, you can see that the new distribution is ns-blue.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>opc@jumpbox-945115 ~<span class=o>]</span>$ kubectl get all,ingress -n ns-blue
</span></span><span class=line><span class=cl>NAME                                      READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>pod/webpage-deployment-7958d6b7b7-pkzmm   1/1     Running   <span class=m>0</span>          115s
</span></span><span class=line><span class=cl>pod/webpage-deployment-7958d6b7b7-vwx22   1/1     Running   <span class=m>0</span>          2m4s
</span></span><span class=line><span class=cl>pod/webpage-deployment-7958d6b7b7-wkbjd   1/1     Running   <span class=m>0</span>          107s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                      TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>    AGE
</span></span><span class=line><span class=cl>service/webpage-service   ClusterIP   10.96.166.161   &lt;none&gt;        8080/TCP   53m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                 READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>deployment.apps/webpage-deployment   3/3     <span class=m>3</span>            <span class=m>3</span>           53m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                            DESIRED   CURRENT   READY   AGE
</span></span><span class=line><span class=cl>replicaset.apps/webpage-deployment-6fbfd769c7   <span class=m>0</span>         <span class=m>0</span>         <span class=m>0</span>       53m
</span></span><span class=line><span class=cl>replicaset.apps/webpage-deployment-7958d6b7b7   <span class=m>3</span>         <span class=m>3</span>         <span class=m>3</span>       2m4s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                        CLASS    HOSTS   ADDRESS          PORTS   AGE
</span></span><span class=line><span class=cl>ingress.networking.k8s.io/webpage-ingress   &lt;none&gt;   *       146.56.118.147   <span class=m>80</span>      53m
</span></span><span class=line><span class=cl><span class=o>[</span>opc@jumpbox-945115 ~<span class=o>]</span>$ kubectl get all,ingress -n ns-green
</span></span><span class=line><span class=cl>NAME                                      READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>pod/webpage-deployment-75c8bb6ffc-5b497   1/1     Running   <span class=m>0</span>          20m
</span></span><span class=line><span class=cl>pod/webpage-deployment-75c8bb6ffc-m8dl4   1/1     Running   <span class=m>0</span>          20m
</span></span><span class=line><span class=cl>pod/webpage-deployment-75c8bb6ffc-xctr4   1/1     Running   <span class=m>0</span>          20m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                      TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>    AGE
</span></span><span class=line><span class=cl>service/webpage-service   ClusterIP   10.96.153.34   &lt;none&gt;        8080/TCP   20m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                 READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>deployment.apps/webpage-deployment   3/3     <span class=m>3</span>            <span class=m>3</span>           21m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                            DESIRED   CURRENT   READY   AGE
</span></span><span class=line><span class=cl>replicaset.apps/webpage-deployment-75c8bb6ffc   <span class=m>3</span>         <span class=m>3</span>         <span class=m>3</span>       21m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                        CLASS    HOSTS   ADDRESS          PORTS   AGE
</span></span><span class=line><span class=cl>ingress.networking.k8s.io/webpage-ingress   &lt;none&gt;   *       146.56.118.147   <span class=m>80</span>      37m
</span></span></code></pre></div></li><li><p>If you access the webpage, you will still be connected to the Green app.</p></li><li><p>Go back to the running deployment pipeline and approve in approval-stage.</p></li><li><p>If approved, it becomes Traffic Shift. ns-blue is now Active. If you look at the annotations of webpage-ingress in ns-green, you can see that it has been changed back to <strong>canary-weight:</strong> &ldquo;<strong>0</strong>&rdquo;. Now all requests are forwarded only to ns-blue.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>opc@jumpbox-945115 ~<span class=o>]</span>$ kubectl get ingress webpage-ingress -n ns-green -o yaml
</span></span><span class=line><span class=cl>apiVersion: networking.k8s.io/v1
</span></span><span class=line><span class=cl>kind: Ingress
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  annotations:
</span></span><span class=line><span class=cl>    kubernetes.io/ingress.class: nginx
</span></span><span class=line><span class=cl>    nginx.ingress.kubernetes.io/canary: <span class=s2>&#34;true&#34;</span>
</span></span><span class=line><span class=cl>    nginx.ingress.kubernetes.io/canary-by-header: redirect-to-namespaceB
</span></span><span class=line><span class=cl>    nginx.ingress.kubernetes.io/canary-weight: <span class=s2>&#34;0&#34;</span>
</span></span><span class=line><span class=cl>...
</span></span></code></pre></div></li><li><p>When you access the web page, you will be connected to the Red app newly deployed in the ns-blue namespace. Even if you request repeatedly several times, you will be connected to the Red app.</p><p><img class=img-fluid1 src=../images/image-20220421112509154.png alt=image-20220421112509154 onerror='this.onerror=null,this.src="images/image-20220421112509154.png"'></p></li><li><p>If the app is distributed with this Blue/Green strategy, the new version is distributed to the currently unserviced namespace using the two specified namespaces, and when approved, the traffic is changed to the new version. Support distribution for versions.</p></li></ol><h4 id=test---rollback>test - rollback</h4><p>If a problem occurs while servicing the new version, rollback to the previous version is available.</p><ol><li><p>Navigate to the deployment pipeline that deployed the current version in the deployment history.</p></li><li><p>From the Traffic Shift menu, click <strong>Revert traffic shift</strong>.</p><p><img class=img-fluid1 src=../images/image-20220421113416970.png alt=image-20220421113416970 onerror='this.onerror=null,this.src="images/image-20220421113416970.png"'></p></li><li><p>After confirming the changes, click <strong>Revert traffic shift</strong> again.</p><p><img class=img-fluid1 src=../images/image-20220421113848569.png alt=image-20220421113848569 onerror='this.onerror=null,this.src="images/image-20220421113848569.png"'></p></li><li><p>Manual rollback operation is complete.</p><p><img class=img-fluid1 src=../images/image-20220421114156771.png alt=image-20220421114156771 onerror='this.onerror=null,this.src="images/image-20220421114156771.png"'></p></li><li><p>There is no distribution change, only Traffic Shift has changed. If you check the Kubernetes distribution status, in the annotations of webpage-ingress in ns-green, it is changed back to <strong>canary-weight:</strong> &ldquo;<strong>100</strong>&rdquo; you can see</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>opc@jumpbox-945115 ~<span class=o>]</span>$ kubectl get ingress webpage-ingress -n ns-green -o yaml
</span></span><span class=line><span class=cl>apiVersion: networking.k8s.io/v1
</span></span><span class=line><span class=cl>kind: Ingress
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  annotations:
</span></span><span class=line><span class=cl>    kubernetes.io/ingress.class: nginx
</span></span><span class=line><span class=cl>    nginx.ingress.kubernetes.io/canary: <span class=s2>&#34;true&#34;</span>
</span></span><span class=line><span class=cl>    nginx.ingress.kubernetes.io/canary-by-header: redirect-to-namespaceB
</span></span><span class=line><span class=cl>    nginx.ingress.kubernetes.io/canary-weight: <span class=s2>&#34;100&#34;</span>
</span></span><span class=line><span class=cl>    nginx.ingress.kubernetes.io/rewrite-target: /<span class=nv>$2</span>
</span></span></code></pre></div></li><li><p>When accessing the web page, you can see that the last deployed app, Red, has been restored to the existing app, Green app, in the ns-blue namespace.</p><p><img class=img-fluid1 src=../images/image-20220421114559253.png alt=image-20220421114559253 onerror='this.onerror=null,this.src="images/image-20220421114559253.png"'></p></li><li><p>If you deploy the app with the Blue/Green strategy provided by the DevOps service in this way, you can deploy Blue/Green by changing the routing rules of two namespaces and Ingress Controller.</p></li></ol><br><br><div class="panel panel-caution"><div class=panel-body><p>As an individual, this article was written with my personal time. There may be errors in the content of the article, and the opinions in the article are personal opinions.</p></div></div><div class=edit-meta>Last updated on 20 Apr 2022<br></div><nav class=pagination><a class="nav nav-prev" href=https://thekoguryo.github.io/en/oracle-cloudnative/devops/1.deploy-app-on-oke-using-devops/ title="3.1 Automating deployment of Spring Boot app to OKE via DevOps service"><i class="fas fa-arrow-left" aria-hidden=true></i> Prev - 3.1 Automating deployment of Spring Boot app to OKE via DevOps service</a>
<a class="nav nav-next" href=https://thekoguryo.github.io/en/oracle-cloudnative/devops/3.canary-stragtegy/ title="3.3 Deploying as a Canary Deployment Strategy for DevOps Services">Next - 3.3 Deploying as a Canary Deployment Strategy for DevOps Services <i class="fas fa-arrow-right" aria-hidden=true></i></a></nav><footer><p class=powered>Powered by <a href=https://gohugo.io>Hugo</a>. Theme by <a href=https://github.com/thingsym/hugo-theme-techdoc>TechDoc</a>. Design by <a href=https://www.thingslabo.com/>Thingsym</a>.</p></footer></main><div class=sidebar><nav><ul><li><form method=get action=https://thekoguryo.github.io//search><input type=text id=search-box name=q placeholder=Search></form><script type=text/javascript>$(document).ready(function(){$("#search-box").val($("#search-query").val())})</script></li><li><a></a></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oci/>OCI(Oracle Cloud Infrastructure)
<button type=button class=toggleButton>
<span class="right hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class=down><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oci/chapter01/>1. OCI Basic Concept
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oci/chapter01/1/>1.1 Regions, Availability Domains</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter01/2/>1.2 Fault Domains</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter01/3/>1.3 Compartment</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter01/4/>1.4 Virtual Cloud Network(VCN)</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter01/5/>1.5 Bare Metal, Virtual Machine</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter01/6/>1.6 Map of offerings between cloud service providers</a></li></ul></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oci/chapter02/>2. Get started with OCI Services
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oci/chapter02/1/>2.1 Creating an Oracle Cloud Free Tier Account</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter02/2/>2.2 Connecting to the OCI Console</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter02/3/>2.3 Using the OCI Console</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter02/4/>2.4 Initial Cloud Account (Tenancy) Architecture</a></li></ul></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oci/chapter03/>3. Use the OCI Compute VM
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oci/chapter03/1/>3.1 Creating a Work Compartment</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter03/2/>3.2 Creating a VCN for a Virtual Network Environment</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter03/3/>3.3 Creating a Key Pair for SSH Connections</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter03/4/>3.4 Creating a Linux Instance</a></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oci/chapter03/5/>3.5 Connecting to a Linux Instance
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oci/chapter03/5/1/>3.5.1 Access from Linux, Mac</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter03/5/2/>3.5.2 Connecting to PuTTY on Windows</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter03/5/3/>3.5.3 Changing the PEM &lt;-> PPK Format</a></li></ul></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oci/chapter03/6/>3.6 Block Volume like hard drive
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oci/chapter03/6/1/>3.6.1 Creating a Block Volume</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter03/6/2/>3.6.2 Mounting Block Volume to Instance</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter03/6/3/>3.6.3 Connecting to Block Volume</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter03/6/4/>3.6.4 Formatting Block Volumes</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter03/6/5/>3.6.5 Mount Block Volume</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter03/6/6/>3.6.6 Unmounting Block Volume</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter03/6/7/>3.6.7 Deleting Block Volume</a></li></ul></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oci/chapter03/7/>3.7 Utilizing Block Volume Backups
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oci/chapter03/7/1/>3.7.1 Backing up Block Volumes</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter03/7/2/>3.7.2 Creating a New Volume from Backup</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter03/7/3/>3.7.3 Copying Backups to Another Region</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter03/7/4/>3.7.4 Backing up Policy-Based Block Volumes</a></li></ul></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oci/chapter03/8/>3.8 Utilizing Boot Volume Backups
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oci/chapter03/8/1/>3.8.1 Backing Up Boot Volume</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter03/8/2/>3.8.2 Creating a New Boot Volume from a Backup</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter03/8/3/>3.8.3 Creating a New Instance with Boot Volume</a></li></ul></li></ul></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oci/chapter04/>4. Reserved Public IP for Static IP Allocation
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oci/chapter04/1/>4.1 Creating a Reserved Public IP</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter04/2/>4.2 Allocating Reserved Public IP</a></li></ul></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oci/chapter05/>5. Using Security Lists to Configure Firewalls
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oci/chapter05/1/>5.1 Installing Apache HTTP Server on Linux Instance</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter05/2/>5.2 Updating the Default Security List</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter05/3/>5.3 Adding a Custom Security List</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter05/5/>5.5 Testing Apache HTTP Server Connection</a></li></ul></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oci/chapter06/>6. Using IAM to Set User Permissions
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oci/chapter06/1/>6.1 Compartment</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter06/2/>6.2 Creating Users</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter06/3/>6.3 Creating Groups</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter06/4/>6.4 Creating a Policy</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter06/5/>6.5 Grabbing the Policy Concept</a></li></ul></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oci/chapter07/>7. Using Object Storage
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oci/chapter07/1/>7.1 Creating a Bucket</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter07/2/>7.2 Uploading Files to Bucket</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter07/3/>7.3 Object Permission Management - Pre-authentication</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter07/4/>7.4 Object Rights Management - Public Bucket</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter07/5/>7.5 Hosting Static Websites with Public Bucket</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter07/6/>7.6 Uploading Files via CloudBerry Explorer</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter07/7/>7.7 Setting up an Archive via Lifecycle</a></li></ul></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oci/chapter08/>8. Using File Storage, a Network File System
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oci/chapter08/1/>8.1 Example File Storage Configuration</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter08/2/>8.2 Mounting and using FSS on a Linux VM</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter08/3/>8.3 Export Option for Access Control</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter08/4/>8.4 Snapshot for Backup</a></li></ul></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oci/chapter09/>9. Machine Image
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oci/chapter09/1/>9.1 OS Image provided by default</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter09/2/>9.2 Create Custom Image from Instance</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter09/3/>9.3 Custom Image Export/Import</a></li></ul></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oci/chapter10/>10. Using Load Balancer for High Availability
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oci/chapter10/1/>10.1 Load Balancer Configuration Example</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter10/2/>10.2 VCN Configuration</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter10/3/>10.3 Creating a Backend Web Server</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter10/4/>10.4 Creating a Subnet for a Load Balancer</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter10/5/>10.5 Creating a Load Balancer</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter10/6/>10.6 Checking the Load Balancer Connection</a></li></ul></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oci/chapter12/>12. Monitoring for OCI resource monitoring
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oci/chapter12/1/>12.1 Enabling Compute Instance Monitoring</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter12/2/>12.2 Creating Monitoring Alarm</a></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oci/chapter12/3/>12.3 OCI Grafana Plugin
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oci/chapter12/3/1/>12.3.1 Installing Grafana on Compute VM</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter12/3/2/>12.3.2 Grafana Configuration</a></li></ul></li></ul></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oci/chapter13/>13. Autoscaling Based on Metric
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oci/chapter13/1/>13.1 Preparation for Autoscaling</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter13/2/>13.2 Configuring Autoscaling</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter13/3/>13.3 Autoscaling Test</a></li></ul></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oci/chapter14/>14. Using Developer Tools
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oci/chapter14/1/>14.1 OCI CLI
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oci/chapter14/1/1/>14.1.1 Installing the OCI CLI
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oci/chapter14/1/1/1/>14.1.1.1 Installing OCI CLI on Windows</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter14/1/1/2/>14.1.1.2 Installing OCI CLI on Linux</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter14/1/1/3/>14.1.1.3 Config File Settings</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter14/1/1/4/>14.1.1.4 Registering API Public Key</a></li></ul></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oci/chapter14/1/2/>14.1.2 Using Object Storage as CLI
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oci/chapter14/1/2/1/>14.1.2.1 Setting IAM Policy for Object Storage</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter14/1/2/2/>14.1.2.2 File Upload via CLI</a></li></ul></li></ul></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oci/chapter14/2/>14.2 REST API
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oci/chapter14/2/1/>14.3.1 OCI Request Signature Version 1</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter14/2/2/>14.3.2 Bash Sample Client</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter14/2/3/>14.3.3 Insomnia - Calling the OCI REST API</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter14/2/4/>14.3.4 Postman - Calling the OCI REST API</a></li></ul></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oci/chapter14/3/>14.2 Terraform
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oci/chapter14/3/1/>14.2.1 Installing Terraform</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter14/3/2/>14.2.2 Creating Terraform Configurations</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter14/3/3/>14.2.3 Obtaining Terraform OCI Provider Connection Information</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter14/3/4/>14.2.4 Running Terraform Configuration</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter14/3/5/>14.2.5 Using workspaces for multiple environments</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter14/3/6/>14.2.6 Example, Creating Users Using List and Count</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter14/3/7/>14.2.7 OCI Terraform Usage Example</a></li></ul></li></ul></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oci/chapter15/>15. Using Resource Manager
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oci/chapter15/1/>15.1 Using the Resource Manager</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter15/2/>15.2 Stack Template for Resource Manager</a></li><li><a href=https://thekoguryo.github.io/en/oci/chapter15/3/>15.3 Configuring a Private Git Server for Resource Manager</a></li></ul></li></ul></li><li class="parent has-sub-menu"><a href=https://thekoguryo.github.io/en/oracle-cloudnative/>Oracle Cloud Native
<button type=button class=toggleButton>
<span class="right hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class=down><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=sub-menu><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oracle-cloudnative/oke/>1. Using Managed Kubernetes OKE
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oracle-cloudnative/oke/1.oke/>1.1 Introduction to Oracle Container Engine for Kubernetes (OKE)</a></li><li><a href=https://thekoguryo.github.io/en/oracle-cloudnative/oke/2.install-quick-oke-cluster/>1.2 Creating an OKE Cluster</a></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oracle-cloudnative/oke/3.access-cluster/>1.3 Connecting the OKE Cluster
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oracle-cloudnative/oke/3.access-cluster/1.cloudshell-access/>1.3.1 Connecting to a Cluster with Cloud Shell</a></li><li><a href=https://thekoguryo.github.io/en/oracle-cloudnative/oke/3.access-cluster/2.local-access/>1.3.2 Connecting to a Cluster in a Local Environment</a></li></ul></li><li><a href=https://thekoguryo.github.io/en/oracle-cloudnative/oke/4.deploy-docker-hub-image-with-lb/>1.4 Deploying Apps and Using Load Balancer</a></li><li><a href=https://thekoguryo.github.io/en/oracle-cloudnative/oke/5.deploy-ocir-image/>1.5 Using OCIR Images</a></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oracle-cloudnative/oke/6.persistent-volume/>1.6 Using Persistent Volumes
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oracle-cloudnative/oke/6.persistent-volume/1.block-volume/>1.6.1 Using Block Volumes</a></li><li><a href=https://thekoguryo.github.io/en/oracle-cloudnative/oke/6.persistent-volume/2.file-storage/>1.6.2 Using File Storage</a></li></ul></li><li><a href=https://thekoguryo.github.io/en/oracle-cloudnative/oke/7.supported-version-and-upgrade/>1.7 Upgrading the Kubernetes Version</a></li></ul></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oracle-cloudnative/ocir/>2. Using OCIR, a container registry
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oracle-cloudnative/ocir/1.scan-image/>2.1 Scanning Container Images</a></li><li><a href=https://thekoguryo.github.io/en/oracle-cloudnative/ocir/2.helm-chart/>2.2 Using Helm Chart Repository</a></li></ul></li><li class="parent has-sub-menu"><a href=https://thekoguryo.github.io/en/oracle-cloudnative/devops/>3. Using OCI DevOps Services as CI/CD
<button type=button class=toggleButton>
<span class="right hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class=down><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=sub-menu><li><a href=https://thekoguryo.github.io/en/oracle-cloudnative/devops/1.deploy-app-on-oke-using-devops/>3.1 Automating deployment of Spring Boot app to OKE via DevOps service</a></li><li class=active><a href=https://thekoguryo.github.io/en/oracle-cloudnative/devops/2.bluegreen-stragtegy/>3.2 Deploying with a Blue/Green Deployment Strategy for DevOps Services</a></li><li><a href=https://thekoguryo.github.io/en/oracle-cloudnative/devops/3.canary-stragtegy/>3.3 Deploying as a Canary Deployment Strategy for DevOps Services</a></li><li><a href=https://thekoguryo.github.io/en/oracle-cloudnative/devops/4.deploy-app-with-helm-chart/>3.4 Automating Deployments with Helm Charts via DevOps Services</a></li><li><a href=https://thekoguryo.github.io/en/oracle-cloudnative/devops/5.detect-vulnerabilities-from-build-pipeline/>3.5 Checking for Package Vulnerabilities When Building DevOps Services</a></li></ul></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/oracle-cloudnative/oci-services/>5. Utilizing OCI Service
<button type=button class=toggleButton>
<span class=right><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class="down hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/oracle-cloudnative/oci-services/logging/2.oci-opensearch.old/1.configure-oci-opensearch/>5.2.2.1 Preparing OpenSearch to Use</a></li><li><a href=https://thekoguryo.github.io/en/oracle-cloudnative/oci-services/logging/2.oci-opensearch.old/2.fluentd-to-oci-opensearch/>5.2.2.2 Send OKE logs by FluentD</a></li></ul></li></ul></li><li class=has-sub-menu><a href=https://thekoguryo.github.io/en/blog/>Blogs
<button type=button class=toggleButton>
<span class="right hidden"><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right"><polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"/></svg></span><span class=down><svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down"><polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"/></svg></span></button></a><ul class=hidden><li><a href=https://thekoguryo.github.io/en/blog/arm-based-server-performance/>ARM-Based Server Performance Comparison: OCI vs. AWS</a></li></ul></li></ul></nav><div class=sidebar-footer></div></div></div><a href=# id=backtothetop-fixed class=backtothetop data-backtothetop-duration=600 data-backtothetop-easing=easeOutQuart data-backtothetop-fixed-fadein=1000 data-backtothetop-fixed-fadeout=1000 data-backtothetop-fixed-bottom=10 data-backtothetop-fixed-right=20><span class="fa-layers fa-fw"><i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up" style=color:#74a683></i></span></a>
<script src=https://thekoguryo.github.io/js/copy-code-button.js></script></div></body></html>