<!DOCTYPE html>
<html lang="ko">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>2.2 DevOps 구성 및 프로젝트 만들기 - TheKoguryo&#39;s 기술 블로그</title>
<meta name="generator" content="Hugo 0.89.2" />
<link href="https://thekoguryo.github.io/oci-cloudnativeindex.xml" rel="alternate" type="application/rss+xml">
<link rel="canonical" href="https://thekoguryo.github.io/oci-cloudnative/cloud-native/devops/2.configure-devops/">
<link rel="stylesheet" href="https://thekoguryo.github.io/oci-cloudnative/css/theme.min.css">
<link rel="stylesheet" href="https://thekoguryo.github.io/oci-cloudnative/css/d2coding.css">
<link rel="stylesheet" href="https://thekoguryo.github.io/oci-cloudnative/css/fontawesome-all.min.css">
<script src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
<link rel="stylesheet" href="https://thekoguryo.github.io/oci-cloudnative/css/chroma.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://thekoguryo.github.io/oci-cloudnative/js/functions.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js"></script>
<script src="https://thekoguryo.github.io/oci-cloudnative/js/jquery.backtothetop/jquery.backtothetop.min.js"></script>
<script src="https://thekoguryo.github.io/oci-cloudnative/js/jqcloud/jqcloud.js"></script>
<link rel="stylesheet" href="https://thekoguryo.github.io/oci-cloudnative/js/jqcloud/jqcloud.css">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-106207316-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-106207316-1');
</script>
</head>
<body>
<div class="container"><header>
<h1>TheKoguryo&#39;s 기술 블로그</h1>

 <span class="version">Version 2021.11.13</span>
<a href="https://github.com/TheKoguryo" class="github"><i class="fab fa-github"></i></a>
</header>
<div class="menu">
<nav>
<ul>
<li ><a href="https://thekoguryo.github.io">Home</a></li>
<li ><a href="/oci-cloudnative/">OCI Cloud Native</a></li>
<li ><a href="https://github.com/TheKoguryo/TheKoguryo.github.io/issues/new">Feedback</a></li></ul>
</nav>
</div>
<div class="content-container">
<main><h1 id="22-devops-서비스를-이용한-spring-boot-앱을-oke에-배포-자동화하기">2.2 DevOps 서비스를 이용한 Spring Boot 앱을 OKE에 배포 자동화하기</h1>
<h2 id="devops-서비스-사용을-위한-iam-policy-설정">DevOps 서비스 사용을 위한 IAM Policy 설정</h2>
<p>DevOps 서비스를 사용하기 위해서는 DevOps 자원들에 권한 설정이 필요합니다. 공식 문서를 참조하여 권한 설정을 위한 Dynamic Group 및 Group에 대한 Policy를 설정합니다.</p>
<ul>
<li><a href="https://docs.oracle.com/en-us/iaas/Content/devops/using/devops_iampolicies.htm#build_policies">https://docs.oracle.com/en-us/iaas/Content/devops/using/devops_iampolicies.htm#build_policies</a></li>
</ul>
<p>아래 Dynamic Group 및 Policy는 위 문서의 예제를 기준으로 작성한 내용으로 요구사항에 따라 일부 변경이 될 수 있습니다.</p>
<h3 id="dynamic-group-만들기">Dynamic Group 만들기</h3>
<p>주어진 Compartment 내에서 DevOps 서비스를 사용할 수 있도록 Compartment에 대한 Dynamic Group을 먼저 생성합니다.</p>
<ol>
<li>
<p>OCI 콘솔에 로그인합니다.</p>
</li>
<li>
<p>좌측 상단 햄버거 메뉴에서 <strong>Identity &amp; Security</strong> &gt; <strong>Identity</strong> &gt; <strong>Compartments</strong>로 이동합니다.</p>
</li>
<li>
<p>DevOps를 사용할 Compartment로 이동하여 OCID를 복사해 둡니다.</p>
</li>
<li>
<p>**Identity ** &gt; <strong>Dynamic Groups</strong>로 이동합니다.</p>
</li>
<li>
<p><strong>Create Dynamic Group</strong>을 클릭합니다.</p>
</li>
<li>
<p>복사해둔 Compartment OCID를 이용해 필요한 Dynamic Group을 만듭니다.</p>
<ul>
<li>
<p>oke-labs-DeployDynamicGroup</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ALL <span class="o">{</span>resource.type <span class="o">=</span> <span class="s1">&#39;devopsrepository&#39;</span>, resource.compartment.id <span class="o">=</span> <span class="s1">&#39;&lt;YourCompartmentOCID&gt;&#39;</span><span class="o">}</span>
</code></pre></div></li>
<li>
<p>oke-labs-CoderepoDynamicGroup</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ALL <span class="o">{</span>resource.type <span class="o">=</span> <span class="s1">&#39;devopsbuildpipeline&#39;</span>, resource.compartment.id <span class="o">=</span> <span class="s1">&#39;&lt;YourCompartmentOCID&gt;&#39;</span><span class="o">}</span>
</code></pre></div></li>
<li>
<p>oke-labs-BuildDynamicGroup</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">All <span class="o">{</span>resource.type <span class="o">=</span> <span class="s1">&#39;devopsdeploypipeline&#39;</span>, resource.compartment.id <span class="o">=</span> <span class="s1">&#39;&lt;YourCompartmentOCID&gt;&#39;</span><span class="o">}</span>
</code></pre></div></li>
</ul>
</li>
</ol>
<h3 id="devops-서비스를-위한-policy-설정하기">DevOps 서비스를 위한 Policy 설정하기</h3>
<ol>
<li>
<p>**Identity ** &gt; <strong>Policies</strong>로 이동합니다.</p>
</li>
<li>
<p><strong>Create Policy</strong>을 클릭하여 새 Policy를 만듭니다.</p>
</li>
<li>
<p><strong>Compartment</strong> 레벨로 다음 Policy를 만듭니다.</p>
<ul>
<li>Name: 예, oke-labs-DevOps-policy</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">Allow dynamic-group oke-labs-CoderepoDynamicGroup to manage devops-family in compartment &lt;YourCompartmentName&gt;
Allow dynamic-group oke-labs-BuildDynamicGroup to manage repos in compartment &lt;YourCompartmentName&gt;
Allow dynamic-group oke-labs-BuildDynamicGroup to <span class="nb">read</span> secret-family in compartment &lt;YourCompartmentName&gt;
Allow dynamic-group oke-labs-BuildDynamicGroup to manage devops-family in compartment &lt;YourCompartmentName&gt;
Allow dynamic-group oke-labs-BuildDynamicGroup to manage generic-artifacts in compartment &lt;YourCompartmentName&gt;
Allow dynamic-group oke-labs-BuildDynamicGroup to use ons-topics in compartment &lt;YourCompartmentName&gt;
</code></pre></div></li>
<li>
<p>Root Compartment 레벨로 다음 Policy를 만듭니다.</p>
<ul>
<li>Name: 예, oke-labs-DevOps-root-policy</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">Allow dynamic-group oke-labs-CoderepoDynamicGroup to manage all-resources in tenancy
Allow dynamic-group oke-labs-CoderepoDynamicGroup to <span class="nb">read</span> secret-family in tenancy
Allow dynamic-group oke-labs-DeployDynamicGroup to manage all-resources in tenancy
</code></pre></div></li>
</ol>
<h2 id="devops-서비스를-통한-cicd-배포-자동화-하기">DevOps 서비스를 통한 CI/CD 배포 자동화 하기</h2>
<h3 id="devops-프로젝트-만들기">DevOps 프로젝트 만들기</h3>
<h4 id="notification-topic-만들기">Notification Topic 만들기</h4>
<p>DevOps 파이프 라인 실행이 발생하는 주요 이벤트를 알려주기 위한 용도로 Notification Topic 설정이 필요합니다.  DevOps 프로젝트 생성시 필수 요구 사항이라 미리 만듭니다</p>
<ol>
<li>
<p>OCI 콘솔에 로그인합니다.</p>
</li>
<li>
<p>좌측 상단 햄버거 메뉴에서 <strong>Developer Services</strong> &gt; <strong>Application Integration</strong> &gt; <strong>Notifications</strong>으로 이동합니다.</p>
</li>
<li>
<p><strong>Create Topic</strong>을 클릭하여 Topic을 생성합니다.</p>
<ul>
<li>Name: 예, oke-labs-devops-topic</li>
</ul>
<p>







<img class="img-fluid1" src="../images/image-20211124113449874.png" alt='image-20211124113449874' />
</p>
</li>
<li>
<p>Notification을 위해 생성한 Topic 이벤트를 가져갈 Subscrition을 일단 생략합니다. 필요시 구성하시면 됩니다.</p>
</li>
</ol>
<h4 id="devops-프로젝트-만들기-1">DevOps 프로젝트 만들기</h4>
<ol>
<li>
<p>OCI 콘솔에 로그인합니다.</p>
</li>
<li>
<p>좌측 상단 햄버거 메뉴에서 <strong>Developer Services</strong> &gt; <strong>DevOps</strong>로 이동합니다.</p>
</li>
<li>
<p>프로젝트 생성을 위해 <strong>Projects</strong>로 이동하여 <strong>Create DevOps project</strong>를 클릭합니다.</p>
</li>
<li>
<p>생성 정보를 입력하여 프로젝트를 만듭니다.</p>
<ul>
<li><strong>Project name</strong>: 예, my-devops-project</li>
<li><strong>Notification Topic</strong>: 앞서 생성한 Topic 선택</li>
</ul>
<p>







<img class="img-fluid1" src="../images/image-20211124114107730.png" alt='image-20211124114107730' />
</p>
</li>
<li>
<p>프로젝트 생성완료</p>
<p>







<img class="img-fluid1" src="../images/image-20211124114552267.png" alt='image-20211124114552267' />
</p>
</li>
</ol>
<h4 id="enable-logging">Enable Logging</h4>
<p>프로젝트 생성 직후 Enable Logging 관련 정보가 보이는 것을 볼 수 있습니다. 설명문에서 보는 것 처럼 Logging을 활성화하지 않을 경우 빌드, 배포 파이프라인 실행후 실행결과는 보는 아래 화면에서 제일 오른쪽에 보이는 실행 로그가 안보입니다. 그래서 Enable Logging은 필수입니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211124115125896.png" alt='image-20211124115125896' />
</p>
<ol>
<li>
<p>Project Overview에서 Enable Log을 클릭하거나 왼쪽 메뉴에서 Logs를 클릭합니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211124115628060.png" alt='image-20211124115628060' />
</p>
</li>
<li>
<p>로그를 활성화 버튼을 토글합니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211124115924501.png" alt='image-20211124115924501' />
</p>
</li>
<li>
<p>대상 Compartment에 이미 Log Group이 있는 경우 나열된 것 중에 선택이 가능합니다. 미리 생성된 Log Group이 없는 경우 아래와 같이 자동입력된 정보를 바탕으로 Enable Log 버튼 클릭시 새로 Log Group과 Log가 만들어 지게 됩니다. 필요시 설정을 수정하고 그렇치 않으면, <strong>Enable Log</strong> 버튼을 클릭합니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211124120114845.png" alt='image-20211124120114845' />
</p>
</li>
</ol>
<h3 id="애플리케이션-배포-자동화-하기">애플리케이션 배포 자동화 하기</h3>
<h4 id="code-repository를-사용하여-애플리케이션-코드-관리하기">Code Repository를 사용하여 애플리케이션 코드 관리하기</h4>
<p>샘플로 Spring Boot Helloword 앱을 만들어 테스트하겠습니다.</p>
<ol>
<li>
<p>코드 저장소 생성을 위해 왼쪽 메뉴에서 <strong>Code Repositories</strong>를 클릭합니다.</p>
</li>
<li>
<p><strong>Create repository</strong>를 클릭하여 저장소를 만듭니다.</p>
<ol>
<li>Repository name: 예, spring-boot-hello-repo</li>
</ol>
<p>







<img class="img-fluid1" src="../images/image-20211124121813443.png" alt='image-20211124121813443' />
</p>
</li>
<li>
<p>생성된 코드 저장소 입니다. 일반적인 Git Repository입니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211124122013899.png" alt='image-20211124122013899' />
</p>
</li>
<li>
<p>실제 개발 작업은 git 명령을 통해 개발 PC에서 진행하면 됩니다. 저장소 상세정보 위에 있는 <strong>Clone</strong> 버튼을 하면 Clone 명령어가 아래 그림처럼 뜨게 됩니다. 여기서는 <strong>Clone with HTTPS</strong>를 사용하겠습니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211124122149834.png" alt='image-20211124122149834' />
</p>
</li>
<li>
<p>개발 PC에 복사한 주소를 사용해 git clone 명령어를 통해 복제합니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">git clone &lt;YourClonewithHTTPS URL&gt;
</code></pre></div></li>
<li>
<p>이때 사용자 인증이 필요합니다. HTTPS기반 사용자 인증시 아래 유저명 형식과 AuthToken을 사용합니다.</p>
<ul>
<li>
<p>인증 유저명</p>
<ul>
<li>Oracle Identity Cloud Service상의 유저: <code>&lt;tenancy-name&gt;/oracleidentitycloudservice/&lt;username&gt;</code></li>
<li>OCI Local 유저: <code>&lt;tenancy-name&gt;/&lt;username&gt;</code></li>
<li>이전 가이드들과 달리 tenancy-namespace가 아닌 tenacy-name인 것에 주의합니다.</li>
</ul>
</li>
<li>
<p>AuthToken: 생성에 대한 내용은 이전 가이드들을 참고합니다.</p>
</li>
<li>
<p>Code Repository의 HTTPS 인증관련 문서</p>
<ul>
<li><a href="https://docs.oracle.com/en-us/iaas/Content/devops/using/clone_repo.htm#https_auth">https://docs.oracle.com/en-us/iaas/Content/devops/using/clone_repo.htm#https_auth</a></li>
</ul>
</li>
<li>
<p>예시</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ git clone https://devops.scmservice.ap-seoul-1.oci.oraclecloud.com/namespaces/cnrlxx3w0wgq/projects/my-devops-project/repositories/spring-boot-hello-repo
Cloning into <span class="s1">&#39;spring-boot-hello-repo&#39;</span>...
Username <span class="k">for</span> <span class="s1">&#39;https://devops.scmservice.ap-seoul-1.oci.oraclecloud.com&#39;</span>: thekoguryo/oke-developer
Password <span class="k">for</span> <span class="s1">&#39;https://oreozz/oke-admin@devops.scmservice.ap-seoul-1.oci.oraclecloud.com&#39;</span>:
remote: Counting objects: 2, <span class="k">done</span>
remote: Finding sources: 100% <span class="o">(</span>2/2<span class="o">)</span>
remote: Getting sizes: 100% <span class="o">(</span>1/1<span class="o">)</span>
Unpacking objects: 100% <span class="o">(</span>2/2<span class="o">)</span>, <span class="k">done</span>.
remote: Total <span class="m">2</span> <span class="o">(</span>delta 0<span class="o">)</span>, reused <span class="m">2</span> <span class="o">(</span>delta 0<span class="o">)</span>
</code></pre></div></li>
<li>
<p>현재 복제된 저장소는 비어 있습니다. 아래 가이드를 통해 spring-boot-hello 샘플 코드를 작성합니다.</p>
<ul>
<li><a href="https://spring.io/guides/gs/spring-boot-docker/">https://spring.io/guides/gs/spring-boot-docker/</a></li>
</ul>
</li>
<li>
<p>작성된 코드를 git 명령어를 통해서 Code Repository에 저장합니다.</p>
<ul>
<li>
<p>예시</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">git add .
git commit -m <span class="s2">&#34;init&#34;</span>
git push
</code></pre></div></li>
</ul>
</li>
<li>
<p>코드 작성 및 반영 완료</p>
<p>







<img class="img-fluid1" src="../images/image-20211124130418241.png" alt='image-20211124130418241' />
</p>
</li>
</ol>
<h4 id="build-pipeline-만들기">Build Pipeline 만들기</h4>
<p>CI/CD 중에 코드를 빌드하여 배포 산출물을 만드는 CI 과정에 해당되는 부분을 Build Pipeline을 통해 구성이 가능합니다.</p>
<ol>
<li>
<p><strong>my-devops-project 프로젝트 페이지</strong>로 이동하여 왼쪽 메뉴의 <strong>Build Pipelines</strong>로 이동합니다.</p>
</li>
<li>
<p><strong>Create build pipeline</strong>을 클릭하여 파이프라인을 생성합니다.</p>
<ul>
<li>
<p>Name: 예, spring-boot-hello-build-pipeline</p>
<p>







<img class="img-fluid1" src="../images/image-20211124131309758.png" alt='image-20211124131309758' />
</p>
</li>
</ul>
</li>
<li>
<p>생성된 파이프라인을 클릭합니다.</p>
</li>
<li>
<p>그림과 같이 Stage를 추가하여 파이프라인 흐름을 구성할 수 있습니다. <strong>Add Stage</strong>를 클릭합니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211124131546998.png" alt='image-20211124131546998' />
</p>
</li>
<li>
<p>제공 Stage</p>
<ul>
<li><strong>Managed Build</strong>: 빌드스펙에 정의된 내용에 따라 빌드 과정을 실행합니다.</li>
<li><strong>Delivery Artifacts</strong>: 빌드 산출물(예, 컨테이너 이미지)를 Artifact Repository에 저장합니다.</li>
<li><strong>Trigger Deployment</strong>: 빌드가 끝나고 Deployment Pipeline을 호출합니다.</li>
<li><strong>Wait</strong>: 일정시간 대기합니다.</li>
</ul>
<p>







<img class="img-fluid1" src="../images/image-20211124131746942.png" alt='image-20211124131746942' />
</p>
</li>
</ol>
<h5 id="build-stage-만들기">Build Stage 만들기</h5>
<ol>
<li>
<p>빌드를 위해 먼저 <strong>Managed Build</strong> Stage를 추가합니다.</p>
</li>
<li>
<p>Managed Build Stage 설정</p>
<ul>
<li><strong>Stage name</strong>: 예, build-stage</li>
<li><strong>Build Spec File Path</strong>: 빌드 스크립트 경로를 지정합니다. 기본적으로 소스 루트에 있는 build_spec.yaml을 파일을 사용합니다.</li>
<li><strong>Primary Code Repository</strong>: 빌드할 메인 소스가 있는 코드 저장소를 지정합니다.</li>
</ul>
<p>







<img class="img-fluid1" src="../images/image-20211124132609354.png" alt='image-20211124132609354' />
</p>
<ul>
<li>
<p>Primary Code Repository 설정 화면</p>
<ul>
<li>대상 소스 코드가 있는 저장소를 지정합니다.</li>
</ul>
<p>







<img class="img-fluid1" src="../images/image-20211124133213445.png" alt='image-20211124133213445' />
</p>
</li>
</ul>
</li>
<li>
<p>설정된 Stage를 <strong>Add</strong>를 클릭하여 추가합니다.</p>
</li>
<li>
<p>아래 그림과 같이 <strong>build-stage</strong>가 추가되었습니다. <strong>Start Manual Run</strong>을 클릭하면 테스트를 해 볼수 있습니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211124133748678.png" alt='image-20211124133748678' />
</p>
</li>
<li>
<p>테스트처럼 소스 코드상의 Build Spec의 정의가 필요합니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211124134401692.png" alt='image-20211124134401692' />
</p>
</li>
<li>
<p>Build Spec은 다음 문서를 참조합니다.</p>
<ul>
<li>
<p><a href="https://docs.oracle.com/en-us/iaas/Content/devops/using/build_specs.htm">https://docs.oracle.com/en-us/iaas/Content/devops/using/build_specs.htm</a></p>
</li>
<li>
<p>문서에 있는 Example 2 기준 예시</p>
<ul>
<li><strong>steps</strong>: 실행할 스크립트를 정의하는 부분입니다. 예제이는 Build Source, Dockerizer 2개의 step이 정의되어 있고 각각 command에서 실행할 스크립트를 정의하고 있습니다. 정의된 순서대로 실행됩니다.</li>
<li><strong>env.exportedVariables</strong>: 전역으로 선언된 환경변수로 이전 step에서 값을 변경하면 그다음 step에도 적용됩니다. Deployment Pipeline을 호출시에도 전달됩니다.</li>
<li><strong>outputArtifacts</strong>: 빌드 산출물의 정의하는 부분으로, 이후 Delivery Artifact Stage를 통해 Artifact Storage에 저장할 때 여기서 정의된 이름을 통해 지정 가능합니다.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="m">0.1</span><span class="w">
</span><span class="w"></span><span class="nt">component</span><span class="p">:</span><span class="w"> </span><span class="l">build</span><span class="w">
</span><span class="w"></span><span class="nt">timeoutInSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">6000</span><span class="w">
</span><span class="w"></span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="l">bash</span><span class="w">
</span><span class="w"></span><span class="nt">env</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">exportedVariables</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="l">BuildServiceDemoVersion</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Command</span><span class="w">
</span><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Build Source&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">timeoutInSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">4000</span><span class="w">
</span><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span><span class="sd">      echo $PATH
</span><span class="sd">      mvn clean install</span><span class="w">      
</span><span class="w">  </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Command</span><span class="w">
</span><span class="w">    </span><span class="nt">timeoutInSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">400</span><span class="w">
</span><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Dockerizer&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span><span class="sd">      BuildServiceDemoVersion=`echo ${OCI_BUILD_RUN_ID} | rev | cut -c 1-7`
</span><span class="sd">      echo $BuildServiceDemoVersion
</span><span class="sd">      docker build -t build-service-demo .</span><span class="w">      
</span><span class="w">
</span><span class="w"></span><span class="nt">outputArtifacts</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">build-service-demo</span><span class="w">
</span><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">DOCKER_IMAGE</span><span class="w">
</span><span class="w">    </span><span class="nt">location</span><span class="p">:</span><span class="w"> </span><span class="l">build-service-demo</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">build-service-demo-kube-manifest</span><span class="w">
</span><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">BINARY</span><span class="w">
</span><span class="w">    </span><span class="nt">location</span><span class="p">:</span><span class="w"> </span><span class="l">deployment/app.yml</span><span class="w">
</span></code></pre></div></li>
</ul>
</li>
<li>
<p>Build Spec 정의</p>
<ul>
<li>
<p>개발한 spring-boot-hello 소스 코드의 root 경로에 build_spec.yaml을 다음과 같이 정의하고 코드 저장소에 저장합니다.</p>
</li>
<li>
<p>build_spec.yaml</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="m">0.1</span><span class="w">
</span><span class="w"></span><span class="nt">component</span><span class="p">:</span><span class="w"> </span><span class="l">build</span><span class="w">
</span><span class="w"></span><span class="nt">timeoutInSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">6000</span><span class="w">
</span><span class="w"></span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="l">bash</span><span class="w">
</span><span class="w"></span><span class="nt">env</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="c"># these are local variables to the build config</span><span class="w">
</span><span class="w">  </span><span class="nt">variables</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">appName</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;spring-boot-hello&#34;</span><span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="c"># exportedVariables are made available to use as parameters in sucessor Build Pipeline stages</span><span class="w">
</span><span class="w">  </span><span class="nt">exportedVariables</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="l">APP_NAME</span><span class="w">
</span><span class="w">    </span>- <span class="l">OCIR_PATH</span><span class="w">
</span><span class="w">    </span>- <span class="l">TAG</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Command</span><span class="w">
</span><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Init exportedVariables&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">timeoutInSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">4000</span><span class="w">
</span><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span><span class="sd">      </span><span class="w">      </span><span class="l">APP_NAME=$appName   </span><span class="w">
</span><span class="w">
</span><span class="w">  </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Command</span><span class="w">
</span><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Build Source&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">timeoutInSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">4000</span><span class="w">
</span><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span><span class="sd">      </span><span class="w">      </span><span class="l">mvn clean install</span><span class="w">
</span><span class="w">
</span><span class="w">  </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Command</span><span class="w">
</span><span class="w">    </span><span class="nt">timeoutInSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">400</span><span class="w">
</span><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Build Source - Post&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span><span class="sd">      </span><span class="w">      </span><span class="l">mkdir -p target/dependency &amp;&amp; (cd target/dependency; jar -xf ../*.jar)</span><span class="w">
</span><span class="w">
</span><span class="w">  </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Command</span><span class="w">
</span><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Define Image Tag - Commit ID&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">timeoutInSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">30</span><span class="w">
</span><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span><span class="sd">      COMMIT_ID=`echo ${OCI_TRIGGER_COMMIT_HASH} | cut -c 1-7`
</span><span class="sd">      BUILDRUN_HASH=`echo ${OCI_BUILD_RUN_ID} | rev | cut -c 1-7`
</span><span class="sd">      [ -z &#34;$COMMIT_ID&#34; ] &amp;&amp; TAG=$BUILDRUN_HASH || TAG=$COMMIT_ID</span><span class="w">      
</span><span class="w">
</span><span class="w">  </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Command</span><span class="w">
</span><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Define OCIR Path&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">timeoutInSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">30</span><span class="w">
</span><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span><span class="sd">      TENANCY_NAMESPACE=`oci os ns get --query data --raw-output`
</span><span class="sd">      REPO_NAME=$appName
</span><span class="sd">      OCIR_PATH=$OCI_RESOURCE_PRINCIPAL_REGION.ocir.io/$TENANCY_NAMESPACE/$REPO_NAME</span><span class="w">      
</span><span class="w">
</span><span class="w">  </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Command</span><span class="w">
</span><span class="w">    </span><span class="nt">timeoutInSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">400</span><span class="w">
</span><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Containerize&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span><span class="sd">      docker build -t new-generated-image .
</span><span class="sd">      docker images</span><span class="w">      
</span><span class="w">
</span><span class="w">  </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Command</span><span class="w">
</span><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Check exportedVariables&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">timeoutInSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">30</span><span class="w">
</span><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l">|  </span><span class="w">
</span><span class="w">      </span><span class="p">[</span><span class="w"> </span>-<span class="l">z &#34;$APP_NAME&#34; ] &amp;&amp; APP_NAME=unknown          </span><span class="w">
</span><span class="w">      </span><span class="p">[</span><span class="w"> </span>-<span class="l">z &#34;$OCIR_PATH&#34; ] &amp;&amp; OCIR_PATH=unknown    </span><span class="w">
</span><span class="w">      </span><span class="p">[</span><span class="w"> </span>-<span class="l">z &#34;$TAG&#34; ] &amp;&amp; TAG=unknown</span><span class="w">
</span><span class="w">      </span><span class="l">echo &#34;APP_NAME: &#34; $APP_NAME      </span><span class="w">
</span><span class="w">      </span><span class="l">echo &#34;OCIR_PATH: &#34; $OCIR_PATH</span><span class="w">
</span><span class="w">      </span><span class="l">echo &#34;TAG: &#34; $TAG</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nt">outputArtifacts</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">output-image</span><span class="w">
</span><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">DOCKER_IMAGE</span><span class="w">
</span><span class="w">    </span><span class="nt">location</span><span class="p">:</span><span class="w"> </span><span class="l">new-generated-image      </span><span class="w">
</span></code></pre></div></li>
</ul>
</li>
<li>
<p>Start Manual Run을 통해 다시 실행하면 아래와 같이 스크립트가 수행되는 것을 볼 수 있습니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211124143654326.png" alt='image-20211124143654326' />
</p>
</li>
<li>
<p>ExportVariables 확인</p>
<p>실행 결과 화면에서 오른쪽 위쪽 점3개를 클릭하여 상세 화면으로 이동하면 Build Output에서 실행결과로 나온 변수값을 볼 수 있습니다. 이 변수들은 이후 Stage 또는 연결되어 호출된 Deployment Pipeline으로 전달되어 사용할 수 있게 됩니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211124150213298.png" alt='image-20211124150213298' />
</p>
</li>
</ol>
<h5 id="컨테이너-이미지-ocir-등록-stage-만들기">컨테이너 이미지 OCIR 등록 Stage 만들기</h5>
<ol>
<li>
<p>Build Pipeline 탭으로 이동합니다.</p>
</li>
<li>
<p>플러스 버튼을 클릭하여 build-stage 다음에 stage를 추가합니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211124144058432.png" alt='image-20211124144058432' />
</p>
</li>
<li>
<p>Delivery Artifact Stage를 선택합니다.</p>
</li>
<li>
<p>stage 이름을 입력하고 Create Artifact를 선택합니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211124144414998.png" alt='image-20211124144414998' />
</p>
</li>
<li>
<p>Container image 유형으로 Artifact 추가합니다.</p>
<ul>
<li>이미지 경로: docker tag를 달때 사용하는 이미지 경로입니다. 직접 입력해도 되지만 여기서는 build-stage에서 넘어온 exportedVariable을 사용하여 <code>${OCIR_PATH}:${TAG}</code> 과 같이 입력합니다.</li>
</ul>
<p>







<img class="img-fluid1" src="../images/image-20211124144817974.png" alt='image-20211124144817974' />
</p>
</li>
<li>
<p>같은 방식으로 하나 더 추가 합니다.</p>
<ul>
<li>Name: generated_image_with_latest</li>
<li>Image Path: ${OCIR_PATH}:latest</li>
</ul>
</li>
<li>
<p>Artifact 매핑</p>
<ul>
<li>
<p>Associate Artifact에서 방금 추가한 2개의 Artifact에 실제 컨테이너 이미지 파일을 매핑해 줍니다. 앞서 build-stage에서 build_spec.yaml에서 정의한 outputArtifacts의 이름을 입력합니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">outputArtifacts</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">output-image</span><span class="w">
</span><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">DOCKER_IMAGE</span><span class="w">
</span><span class="w">    </span><span class="nt">location</span><span class="p">:</span><span class="w"> </span><span class="l">new-generated-image </span><span class="w">
</span></code></pre></div></li>
</ul>
<p>







<img class="img-fluid1" src="../images/image-20211124145533765.png" alt='image-20211124145533765' />
</p>
</li>
<li>
<p>이제 delivery stage까지 추가하였습니다.</p>
</li>
<li>
<p>파이프라인을 다시 실행해 봅니다. 실제 소스코드로 빌드된 컨테이너 이미지가 OCIR에 자동으로 등록됩니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211124152718783.png" alt='image-20211124152718783' />
</p>
</li>
</ol>
<h4 id="deploy-pipeline-만들기">Deploy Pipeline 만들기</h4>
<p>CI/CD 중에 빌드된 산출물을 가지고 실제 서버에 배포하는 CD 과정에 해당되는 부분을 Deployment Pipeline을 통해 구성이 가능합니다.</p>
<ol>
<li>
<p><strong>my-devops-project 프로젝트 페이지</strong>로 이동하여 왼쪽 메뉴의 <strong>Deployment Pipelines</strong>로 이동합니다.</p>
</li>
<li>
<p><strong>Create pipeline</strong>을 클릭하여 파이프라인을 생성합니다.</p>
<ul>
<li>
<p>Name: 예, spring-boot-hello-deployment-pipeline</p>
<p>







<img class="img-fluid1" src="../images/image-20211124164303619.png" alt='image-20211124164303619' />
</p>
</li>
</ul>
</li>
<li>
<p>생성된 파이프라인을 클릭합니다.</p>
</li>
<li>
<p><strong>Add Stage</strong>를 클릭하여 Stage를 추가합니다.</p>
</li>
<li>
<p>제공 Stage</p>
<ul>
<li>
<p><strong>Deploy</strong>: OKE, Compute 인스턴스 배포, Oracle Function에 배포 기능을 제공합니다.</p>
</li>
<li>
<p><strong>Control</strong>: 승인 대기, 트래픽 변경, 대기 등을 지원합니다.</p>
</li>
<li>
<p><strong>Integration</strong>: 커스텀 로직 수행을 위한 Oracle Function 실행을 지원합니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211124164550158.png" alt='image-20211124164550158' />
</p>
</li>
</ul>
</li>
</ol>
<h5 id="kubernetes에-배포할-manifest-파일-준비">Kubernetes에 배포할 manifest 파일 준비</h5>
<p>Kubernetes에 배포할 Stage 유형을 사용하기 위해서는 사전에 배포할 manifest yaml 파일을 준비해야 합니다.</p>
<ol>
<li>
<p><strong>my-devops-project 프로젝트 페이지</strong>로 이동하여 왼쪽 메뉴의 <strong>Artifacts</strong>로 이동합니다.</p>
</li>
<li>
<p>Artifacts로 앞서 빌드 파이프라인 만들때 등록한 2개가 있는 것을 볼수 있습니다. 여기에 등록된 Artifact는 재사용이 가능합니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211124165820408.png" alt='image-20211124165820408' />
</p>
</li>
<li>
<p>manifest 파일을 등록하기 위해 Add artifact를 클릭합니다.</p>
</li>
<li>
<p>4 가지 등록 유형을 제공합니다. 이중에 <strong>Kubernetes manifest</strong>를 선택합니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211124171921813.png" alt='image-20211124171921813' />
</p>
</li>
<li>
<p>Kubernetes manifest 유형에는 Artifact Source로 2가지 유형을 제고합니다.</p>
<ul>
<li>Artifact Registry Repository: Container Registry로 OCIR을 제공하고 있듯시 Artifact Registry를 서비스로 제공하고 있습니다. 그곳에 있는 자원을 참조할 경우에 선택합니다.</li>
<li>Inline: 인라인은 현재 DevOps 프로젝트에 있는 여기 Artifact에 직접 입력하는 것을 말합니다.</li>
</ul>
</li>
<li>
<p>Artifact Source로 Inline 유형으로 다음과 같이 등록합니다.</p>
<ul>
<li>Name: 예, k8s_spring_boot_deploy_template</li>
</ul>
<p>







<img class="img-fluid1" src="../images/image-20211124172449484.png" alt='image-20211124172449484' />
</p>
<ul>
<li>
<p>Value</p>
<p>앞 서와 같이 build-stage에서 export한 변수값들을 사용할 수 있습니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">${APP_NAME}</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">${APP_NAME}</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">${APP_NAME}</span><span class="w">
</span><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">${APP_NAME}</span><span class="w">
</span><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">${APP_NAME}</span><span class="w">
</span><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">${OCIR_PATH}:${TAG}</span><span class="w">
</span><span class="w"></span><span class="nn">---</span><span class="w">
</span><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">${APP_NAME}-service</span><span class="w">
</span><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w"> 
</span><span class="w">    </span><span class="nt">service.beta.kubernetes.io/oci-load-balancer-shape</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;10Mbps&#34;</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">LoadBalancer</span><span class="w">
</span><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span><span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">${APP_NAME}</span><span class="w">
</span></code></pre></div></li>
</ul>
</li>
</ol>
<h5 id="kubernetes-enviroment-등록하기">Kubernetes Enviroment 등록하기</h5>
<ol>
<li>
<p><strong>my-devops-project 프로젝트 페이지</strong>로 이동하여 왼쪽 메뉴의 <strong>Enviroments</strong>로 이동하여 배포할 OKE 환경을 등록합니다.</p>
</li>
<li>
<p>OKE 유형을 선택합니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211124173434602.png" alt='image-20211124173434602' />
</p>
</li>
<li>
<p>배포할 클러스터를 선택합니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211124173503618.png" alt='image-20211124173503618' />
</p>
</li>
</ol>
<h5 id="kubernetes-manifest-배포-stage-만들기">Kubernetes manifest 배포 Stage 만들기</h5>
<ol>
<li>
<p>등록한 Deployment Pipeline(spring-boot-hello-deployment-pipeline) 설정 페이지로 이동합니다.</p>
</li>
<li>
<p><strong>Add Stage</strong>를 클릭하여 <strong>Apply manifest to your Kubernetes cluster</strong> Stage를 추가합니다.</p>
</li>
<li>
<p>배포할 환경 및 manifest 파일을 선택합니다</p>
<p>







<img class="img-fluid1" src="../images/image-20211124173653024.png" alt='image-20211124173653024' />
</p>
</li>
<li>
<p>파이프라인 완성</p>
<p>







<img class="img-fluid1" src="../images/image-20211124173838414.png" alt='image-20211124173838414' />
</p>
</li>
</ol>
<h4 id="build-pipeline에서-deployment-pipeline-호출하기">Build Pipeline에서 Deployment Pipeline 호출하기</h4>
<p>앞서 만든 Build Pipeline에서 컨테이너 이미지 까지 OCIR에 등록하고 나면, OKE에 배포할 Deployment Pipeline을 기동되어야 전체 빌드에서 배포까지가 완료됩니다. 이제 Deployment Pipeline을 등록하였으므로, Build Pipeline에서 호출할 수 있습니다.</p>
<ol>
<li>
<p>앞서 만든 **Build Pipelines(spring-boot-hello-build-pipeline)**으로 이동합니다.</p>
</li>
<li>
<p>파이프라인 마지막에 Stage를 추가합니다.</p>
</li>
<li>
<p><strong>Trigger Deployment</strong> 유형을 선택합니다.</p>
</li>
<li>
<p>설정한 Deployment Pipeline을 지정합니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211124174411300.png" alt='image-20211124174411300' />
</p>
</li>
<li>
<p>전체 흐름이 완료되었습니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211124174455240.png" alt='image-20211124174455240' />
</p>
</li>
</ol>
<h4 id="trigger-설정하기">Trigger 설정하기</h4>
<p>지금 까지는 테스트를 하기 위해 Build Pipeline에서 Start Manual Run을 통해 시작하였습니다. 실제로는 개발자가 코드를 코드 저장소에 반영이 될 때 자동으로 빌드, 배포 파이프라인이 동작할 필요가 있습니다. Trigger는 코드 저장소에 발생한 이벤트를 통해 빌드 파이프라인을 시작하게 하는 역할을 하게 됩니다.</p>
<ol>
<li>
<p><strong>my-devops-project 프로젝트 페이지</strong>로 이동하여 왼쪽 메뉴의 <strong>Trigger</strong>로 이동합니다.</p>
</li>
<li>
<p><strong>Create trigger</strong>을 클릭합니다.</p>
</li>
<li>
<p>Trigger를 설정합니다.</p>
<ul>
<li><strong>Name</strong>: 예, spring-boot-hello-trigger</li>
<li><strong>Source Code Repository</strong>: OCI Code Repository, GitHub, GitLab 연동을 지원하며, 예제에서는 앞서 만든 OCI Code Repository상의 spring-boot-hello-repo를 선택합니다.</li>
<li><strong>Actions</strong>: 트리거링 되었을 때 호출하는 액션으로 작성한 빌드 파이프라인인 spring-boot-hello-build-pipeline을 선택합니다.</li>
</ul>
<p>







<img class="img-fluid1" src="../images/image-20211125102603275.png" alt='image-20211125102603275' />
</p>
</li>
<li>
<p>설정이 완료되었습니다.</p>
</li>
</ol>
<h4 id="테스트">테스트</h4>
<ol>
<li>
<p>Trigger에서 지정한 spring-boot-hello 소스 코드에 임의의 변경사항을 발생시키고 Code Repository에 반영합니다.</p>
</li>
<li>
<p>저는 Application.java에 있는 응답메시지를 &ldquo;Hello OCI DevOps&quot;로 변경하고 반영하셨습니다.</p>
</li>
<li>
<p>빌드 실행 내역을 보면, 그림과 같이 Trigger 된것은 Commit ID가 함께 보이며, Code Repository와 링크되어 있습니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211125105119229.png" alt='image-20211125105119229' />
</p>
<ul>
<li>
<p>Commit ID를 클릭하면 Code Repository상의 코드 변경 분을 확인할 수 있습니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211125105915622.png" alt='image-20211125105915622' />
</p>
</li>
</ul>
</li>
<li>
<p>빌드 파이프라인이 정상적으로 코드 빌드 부터 컨테이너 이미지 생성, 배포 파이프라인 호출까지 실행되었습니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211125105347899.png" alt='image-20211125105347899' />
</p>
</li>
<li>
<p>배포 파이프라인도 정상 실행되었습니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211125105521642.png" alt='image-20211125105521642' />
</p>
</li>
<li>
<p>OKE 클러스터를 조회해 보면 정상 배포 되었습니다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">oke_admin@cloudshell:~ <span class="o">(</span>ap-seoul-1<span class="o">)</span>$ kubectl get all
NAME                                     READY   STATUS    RESTARTS   AGE
pod/spring-boot-hello-54848fcfd5-5jpxh   1/1     Running   <span class="m">0</span>          5m39s

NAME                                TYPE           CLUSTER-IP      EXTERNAL-IP      PORT<span class="o">(</span>S<span class="o">)</span>        AGE
service/kubernetes                  ClusterIP      10.96.0.1       &lt;none&gt;           443/TCP        16h
service/spring-boot-hello-service   LoadBalancer   10.96.186.158   146.56.186.172   80:32224/TCP   41m

NAME                                READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/spring-boot-hello   1/1     <span class="m">1</span>            <span class="m">1</span>           15h

NAME                                           DESIRED   CURRENT   READY   AGE
replicaset.apps/spring-boot-hello-54557d9c47   <span class="m">0</span>         <span class="m">0</span>         <span class="m">0</span>       41m
replicaset.apps/spring-boot-hello-54848fcfd5   <span class="m">1</span>         <span class="m">1</span>         <span class="m">1</span>       5m39s
</code></pre></div></li>
<li>
<p>서비스 주소로 접속시 정상 동작을 확인할 수 있습니다.</p>
<p>







<img class="img-fluid1" src="../images/image-20211125105715911.png" alt='image-20211125105715911' />
</p>
</li>
</ol>
<br>
<br>
<em>** 이 글은 개인으로서, 개인의 시간을 할애하여 작성된 글입니다. 글의 내용에 오류가 있을 수 있으며, 글 속의 의견은 개인적인 의견입니다. **</em>

 <div class="edit-meta">Last updated on 25 Nov 2021<br></div><nav class="pagination"><a class="nav nav-prev" href="https://thekoguryo.github.io/oci-cloudnative/cloud-native/devops/1.devops/" title="2.1 OCI DevOps 서비스 소개"><i class="fas fa-arrow-left" aria-hidden="true"></i> Prev - 2.1 OCI DevOps 서비스 소개</a>
<a class="nav nav-next" href="https://thekoguryo.github.io/oci-cloudnative/cloud-native/devops/1.devops/" title="2.1 OCI DevOps 서비스 소개">Next - 2.1 OCI DevOps 서비스 소개 <i class="fas fa-arrow-right" aria-hidden="true"></i></a>
</nav><footer><p class="powered">Powered by <a href="https://gohugo.io">Hugo</a>. Theme by <a href="https://github.com/thingsym/hugo-theme-techdoc">TechDoc</a>. Design by <a href="https://www.thingslabo.com/">Thingsym</a>.</p>
</footer>
</main><div class="sidebar">
<nav>
<ul>


<li>
  <form method="get" action="https://thekoguryo.github.io/oci-cloudnative/search">
    <input type="text" id="search-box" name="q" placeholder="Search"/>
  </form>
  
  <script type="text/javascript">
    $(document).ready(function() {
      $('#search-box').val($('#search-query').val());
    });
  </script>
</li>
<li><a> </a></li>



<li class="parent has-sub-menu">
  <a href="https://thekoguryo.github.io/oci-cloudnative/cloud-native/">
    Oracle Cloud Native Services
    <button type="button" class="toggleButton">
      <span class="right  hidden">
        <svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right">
          <polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"></polyline>
        </svg></span>
      <span class="down " >
        <svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down">
          <polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"></polyline>
        </svg>
      </span>
    </button>
  </a>
<ul class="sub-menu">



<li class=" has-sub-menu">
  <a href="https://thekoguryo.github.io/oci-cloudnative/cloud-native/oke-basic/">
    1. OKE(Oracle Container Engine for Kubernetes) 기초
    <button type="button" class="toggleButton">
      <span class="right ">
        <svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right">
          <polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"></polyline>
        </svg></span>
      <span class="down  hidden" >
        <svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down">
          <polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"></polyline>
        </svg>
      </span>
    </button>
  </a>
<ul class=" hidden">
<li class=""><a href="https://thekoguryo.github.io/oci-cloudnative/cloud-native/oke-basic/1.oke/">1.1 OKE(Oracle Container Engine for Kubernetes) 소개</a></li>
<li class=""><a href="https://thekoguryo.github.io/oci-cloudnative/cloud-native/oke-basic/2.install-quick-oke-cluster/">1.2 OKE 클러스터 만들기</a></li>



<li class=" has-sub-menu">
  <a href="https://thekoguryo.github.io/oci-cloudnative/cloud-native/oke-basic/3.access-cluster/">
    1.3 OKE 클러스터 연결하기
    <button type="button" class="toggleButton">
      <span class="right ">
        <svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right">
          <polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"></polyline>
        </svg></span>
      <span class="down  hidden" >
        <svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down">
          <polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"></polyline>
        </svg>
      </span>
    </button>
  </a>
<ul class=" hidden">
<li class=""><a href="https://thekoguryo.github.io/oci-cloudnative/cloud-native/oke-basic/3.access-cluster/1.cloudshell-access/">1.3.1 Cloud Shell로 클러스터 연결하기</a></li>
<li class=""><a href="https://thekoguryo.github.io/oci-cloudnative/cloud-native/oke-basic/3.access-cluster/2.local-access/">1.3.2 로컬 환경에서 클러스터 연결하기</a></li>
</ul>
  
</li>
<li class=""><a href="https://thekoguryo.github.io/oci-cloudnative/cloud-native/oke-basic/4.deploy-docker-hub-image-with-lb/">1.4 앱 배포 및 Load Balancer 사용하기</a></li>
<li class=""><a href="https://thekoguryo.github.io/oci-cloudnative/cloud-native/oke-basic/5.deploy-ocir-image/">1.5 OCIR 이미지 사용하기</a></li>



<li class=" has-sub-menu">
  <a href="https://thekoguryo.github.io/oci-cloudnative/cloud-native/oke-basic/6.persistent-volume/">
    1.6 Persistent Volume 사용하기
    <button type="button" class="toggleButton">
      <span class="right ">
        <svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right">
          <polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"></polyline>
        </svg></span>
      <span class="down  hidden" >
        <svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down">
          <polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"></polyline>
        </svg>
      </span>
    </button>
  </a>
<ul class=" hidden">
<li class=""><a href="https://thekoguryo.github.io/oci-cloudnative/cloud-native/oke-basic/6.persistent-volume/1.block-volume/">1.6.1 Block Volume 사용하기</a></li>
<li class=""><a href="https://thekoguryo.github.io/oci-cloudnative/cloud-native/oke-basic/6.persistent-volume/2.file-storage/">1.6.2 File Storage 사용하기</a></li>
</ul>
  
</li>
<li class=""><a href="https://thekoguryo.github.io/oci-cloudnative/cloud-native/oke-basic/7.supported-version-and-upgrade/">1.7 Kubernetes 버전 업그레이드</a></li>
<li class=""><a href="https://thekoguryo.github.io/oci-cloudnative/cloud-native/oke-basic/8.monitor-application-log/">1.8 애플리케이션 로그 모니터링</a></li>
</ul>
  
</li>



<li class="parent has-sub-menu">
  <a href="https://thekoguryo.github.io/oci-cloudnative/cloud-native/devops/">
    2. DevOps(관리형 CI/CD) 서비스 사용하기
    <button type="button" class="toggleButton">
      <span class="right  hidden">
        <svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-right">
          <polyline fill="none" stroke="#000" stroke-width="1.03" points="7 4 13 10 7 16"></polyline>
        </svg></span>
      <span class="down " >
        <svg width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="chevron-down">
          <polyline fill="none" stroke="#000" stroke-width="1.03" points="16 7 10 13 4 7"></polyline>
        </svg>
      </span>
    </button>
  </a>
<ul class="sub-menu">
<li class=""><a href="https://thekoguryo.github.io/oci-cloudnative/cloud-native/devops/1.devops/">2.1 OCI DevOps 서비스 소개</a></li>
<li class="active"><a href="https://thekoguryo.github.io/oci-cloudnative/cloud-native/devops/2.configure-devops/">2.2 DevOps 구성 및 프로젝트 만들기</a></li>
</ul>
  
</li>
</ul>
  
</li>
</ul>
</nav>


<div class="sidebar-footer"></div>
</div>
</div><a href="#" id="backtothetop-fixed" class="backtothetop"
 data-backtothetop-duration="600"
 data-backtothetop-easing="easeOutQuart"
 data-backtothetop-fixed-fadeIn="1000"
 data-backtothetop-fixed-fadeOut="1000"
 data-backtothetop-fixed-bottom="10"
 data-backtothetop-fixed-right="20">
<span class="fa-layers fa-fw">
<i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i>
</span></a>

<script src="https://thekoguryo.github.io/oci-cloudnative/js/copy-code-button.js"></script></div>
</body>
</html>
